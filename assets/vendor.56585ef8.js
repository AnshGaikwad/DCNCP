/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function r(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(ed){o(ed)}}function a(t){try{u(r.throw(t))}catch(ed){o(ed)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(ed){o=[6,ed],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function o(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function a(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=u(t[n],e[n]));return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var c=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function l(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(ed){return!1}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var f=function(t){function n(e,r,i){var o=t.call(this,r)||this;return o.code=e,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf(o,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,p.prototype.create),o}return e(n,t),n}(Error),p=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?d(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new f(i,a,r);return u},t}();function d(t,e){return t.replace(y,(function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"}))}var y=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function m(t,e){var n=new g(t,e);return n.subscribe.bind(n)}var g=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=b),void 0===r.error&&(r.error=b),void 0===r.complete&&(r.complete=b);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(ed){}})),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(ed){"undefined"!=typeof console&&console.error&&console.error(ed)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function b(){}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w(t){return t&&t._delegate?t._delegate:t}var I=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},t}(),E=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t="[DEFAULT]");var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new c;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:e});r&&n.resolve(r)}catch(ed){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=n({identifier:"[DEFAULT]",optional:!1},t),r=e.identifier,i=e.optional,o=this.normalizeInstanceIdentifier(r);if(!this.isInitialized(o)&&!this.shouldAutoInitialize()){if(i)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:o})}catch(ed){if(i)return null;throw ed}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService({instanceIdentifier:"[DEFAULT]"})}catch(ed){}try{for(var r=o(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var a=s(i.value,2),u=a[0],c=a[1],h=this.normalizeInstanceIdentifier(u);try{var l=this.getOrInitializeService({instanceIdentifier:h});c.resolve(l)}catch(ed){}}}catch(f){e={error:f}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}},t.prototype.clearInstance=function(t){void 0===t&&(t="[DEFAULT]"),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(a(a([],s(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))),s(t.filter((function(t){return"_delete"in t})).map((function(t){return t._delete()})))))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.isInitialized=function(t){return void 0===t&&(t="[DEFAULT]"),this.instances.has(t)},t.prototype.initialize=function(t){var e,n;void 0===t&&(t={});var r=t.instanceIdentifier,i=void 0===r?"[DEFAULT]":r,a=t.options,u=void 0===a?{}:a,c=this.normalizeInstanceIdentifier(i);if(this.isInitialized(c))throw Error(this.name+"("+c+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var h=this.getOrInitializeService({instanceIdentifier:c,options:u});try{for(var l=o(this.instancesDeferred.entries()),f=l.next();!f.done;f=l.next()){var p=s(f.value,2),d=p[0],y=p[1];c===this.normalizeInstanceIdentifier(d)&&y.resolve(h)}}catch(v){e={error:v}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}return h},t.prototype.getOrInitializeService=function(t){var e,n=t.instanceIdentifier,r=t.options,i=void 0===r?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(e=n,"[DEFAULT]"===e?void 0:e),options:i}),this.instances.set(n,o),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(s){}return o||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:"[DEFAULT]":t},t.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var T,_=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new E(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function S(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var N,D,A=[];(D=N||(N={}))[D.DEBUG=0]="DEBUG",D[D.VERBOSE=1]="VERBOSE",D[D.INFO=2]="INFO",D[D.WARN=3]="WARN",D[D.ERROR=4]="ERROR",D[D.SILENT=5]="SILENT";var C,k={debug:N.DEBUG,verbose:N.VERBOSE,info:N.INFO,warn:N.WARN,error:N.ERROR,silent:N.SILENT},O=N.INFO,R=((T={})[N.DEBUG]="log",T[N.VERBOSE]="log",T[N.INFO]="info",T[N.WARN]="warn",T[N.ERROR]="error",T),x=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=R[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,S(["["+i+"]  "+t.name+":"],n))}},L=function(){function t(t){this.name=t,this._logLevel=O,this._logHandler=x,this._userLogHandler=null,A.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in N))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?k[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,N.DEBUG],t)),this._logHandler.apply(this,S([this,N.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,N.VERBOSE],t)),this._logHandler.apply(this,S([this,N.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,N.INFO],t)),this._logHandler.apply(this,S([this,N.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,N.WARN],t)),this._logHandler.apply(this,S([this,N.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,N.ERROR],t)),this._logHandler.apply(this,S([this,N.ERROR],t))},t}();function P(t){A.forEach((function(e){e.setLogLevel(t)}))}var F,M=((C={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",C["bad-app-name"]="Illegal App name: '{$appName}",C["duplicate-app"]="Firebase App named '{$appName}' already exists",C["app-deleted"]="Firebase App named '{$appName}' already deleted",C["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",C["invalid-log-argument"]="First argument to `onLog` must be null or a function.",C),V=new p("app","Firebase",M),U=((F={})["@firebase/app"]="fire-core",F["@firebase/analytics"]="fire-analytics",F["@firebase/auth"]="fire-auth",F["@firebase/database"]="fire-rtdb",F["@firebase/functions"]="fire-fn",F["@firebase/installations"]="fire-iid",F["@firebase/messaging"]="fire-fcm",F["@firebase/performance"]="fire-perf",F["@firebase/remote-config"]="fire-rc",F["@firebase/storage"]="fire-gcs",F["@firebase/firestore"]="fire-fst",F["fire-js"]="fire-js",F["firebase-wrapper"]="fire-js-all",F),q=new L("@firebase/app"),B=function(){function t(t,e,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=u(void 0,t),this.container=new _(e.name),this._addComponent(new I("app",(function(){return r}),"PUBLIC")),this.firebase_.INTERNAL.components.forEach((function(t){return r._addComponent(t)}))}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e="[DEFAULT]"),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e="[DEFAULT]"),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(ed){q.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,ed)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw V.create("app-deleted",{appName:this.name_})},t}();B.prototype.name&&B.prototype.options||B.prototype.delete||console.log("dc");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function j(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={});if("object"!=typeof i||null===i){i={name:i}}var o=i;void 0===o.name&&(o.name="[DEFAULT]");var s=o.name;if("string"!=typeof s||!s)throw V.create("bad-app-name",{appName:String(s)});if(v(e,s))throw V.create("duplicate-app",{appName:s});var a=new t(n,o,r);return e[s]=a,a},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=U[t])&&void 0!==r?r:t;n&&(i+="-"+n);var s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){var u=['Unable to register library "'+i+'" with version "'+e+'":'];return s&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),s&&a&&u.push("and"),a&&u.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void q.warn(u.join(" "))}o(new I(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},setLogLevel:P,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw V.create("invalid-log-argument");!function(t,e){for(var n=function(n){var r=null;e&&e.level&&(r=k[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var s=i.map((function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(e){return null}})).filter((function(t){return t})).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:N[n].toLowerCase(),message:s,args:i,type:e.name})}},r=0,i=A;r<i.length;r++)n(i[r])}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,e)},apps:null,SDK_VERSION:"8.4.0",INTERNAL:{registerComponent:o,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){if("serverAuth"===e)return null;return e}}};function i(t){if(!v(e,t=t||"[DEFAULT]"))throw V.create("no-app",{appName:t});return e[t]}function o(o){var s=o.name;if(n.has(s))return q.debug("There were multiple attempts to register component "+s+"."),"PUBLIC"===o.type?r[s]:null;if(n.set(s,o),"PUBLIC"===o.type){var a=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[s])throw V.create("invalid-app-argument",{appName:s});return t[s]()};void 0!==o.serviceProps&&u(a,o.serviceProps),r[s]=a,t.prototype[s]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getService.bind(this,s);return n.apply(this,o.multipleInstances?t:[])}}for(var c=0,h=Object.keys(e);c<h.length;c++){var l=h[c];e[l]._addComponent(o)}return"PUBLIC"===o.type?r[s]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,r}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var K=function t(){var e=j(B);return e.INTERNAL=n(n({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){u(e,t)},createSubscribe:m,ErrorFactory:p,deepExtend:u}),e}(),G=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if("object"==typeof self&&self.self===self&&void 0!==self.firebase){q.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var z=self.firebase.SDK_VERSION;z&&z.indexOf("LITE")>=0&&q.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var H=K.initializeApp;K.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l()&&q.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),H.apply(void 0,t)};var Q,W,Y=K;(Q=Y).INTERNAL.registerComponent(new I("platform-logger",(function(t){return new G(t)}),"PRIVATE")),Q.registerVersion("@firebase/app","0.6.20",W),Q.registerVersion("fire-js","");
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Y.registerVersion("firebase","8.4.2","app");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var X=function(t,e){return(X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function $(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var J,Z="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},tt=tt||{},et=Z||self;function nt(){}function rt(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function it(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ot="closure_uid_"+(1e9*Math.random()>>>0),st=0;function at(t,e,n){return t.call.apply(t.bind,arguments)}function ut(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function ct(t,e,n){return(ct=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?at:ut).apply(null,arguments)}function ht(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function lt(){return Date.now()}function ft(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function pt(){this.j=this.j,this.i=this.i}pt.prototype.j=!1,pt.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,ot)&&t[ot]||(t[ot]=++st))},pt.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var dt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},yt=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function vt(t){return Array.prototype.concat.apply([],arguments)}function mt(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function gt(t){return/^[\s\xa0]*$/.test(t)}var bt,wt=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function It(t,e){return-1!=t.indexOf(e)}function Et(t,e){return t<e?-1:t>e?1:0}t:{var Tt=et.navigator;if(Tt){var _t=Tt.userAgent;if(_t){bt=_t;break t}}bt=""}function St(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Nt(t){var e={};for(var n in t)e[n]=t[n];return e}var Dt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function At(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Dt.length;o++)n=Dt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Ct(t){return Ct[" "](t),t}Ct[" "]=nt;var kt,Ot,Rt=It(bt,"Opera"),xt=It(bt,"Trident")||It(bt,"MSIE"),Lt=It(bt,"Edge"),Pt=Lt||xt,Ft=It(bt,"Gecko")&&!(It(bt.toLowerCase(),"webkit")&&!It(bt,"Edge"))&&!(It(bt,"Trident")||It(bt,"MSIE"))&&!It(bt,"Edge"),Mt=It(bt.toLowerCase(),"webkit")&&!It(bt,"Edge");function Vt(){var t=et.document;return t?t.documentMode:void 0}t:{var Ut="",qt=(Ot=bt,Ft?/rv:([^\);]+)(\)|;)/.exec(Ot):Lt?/Edge\/([\d\.]+)/.exec(Ot):xt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Ot):Mt?/WebKit\/(\S+)/.exec(Ot):Rt?/(?:Version)[ \/]?(\S+)/.exec(Ot):void 0);if(qt&&(Ut=qt?qt[1]:""),xt){var Bt=Vt();if(null!=Bt&&Bt>parseFloat(Ut)){kt=String(Bt);break t}}kt=Ut}var jt,Kt={};function Gt(t){return function(t,e){var n=Kt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=wt(String(kt)).split("."),r=wt(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=Et(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||Et(0==s[2].length,0==a[2].length)||Et(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}if(et.document&&xt){var zt=Vt();jt=zt||(parseInt(kt,10)||void 0)}else jt=void 0;var Ht=jt,Qt=!xt||9<=Number(Ht),Wt=xt&&!Gt("9"),Yt=function(){if(!et.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{et.addEventListener("test",nt,e),et.removeEventListener("test",nt,e)}catch(n){}return t}();function Xt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function $t(t,e){if(Xt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Ft){t:{try{Ct(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Jt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}Xt.prototype.b=function(){this.defaultPrevented=!0},ft($t,Xt);var Jt={2:"touch",3:"pen",4:"mouse"};$t.prototype.b=function(){$t.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Wt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var Zt="closure_listenable_"+(1e6*Math.random()|0),te=0;function ee(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++te,this.Y=this.Z=!1}function ne(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function re(t){this.src=t,this.a={},this.b=0}function ie(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=dt(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(ne(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function oe(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}re.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=oe(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new ee(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var se="closure_lm_"+(1e6*Math.random()|0),ae={};function ue(t,e,n,r,i){if(r&&r.once)return he(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)ue(t,e[o],n,r,i);return null}return n=ge(n),t&&t[Zt]?t.va(e,n,it(r)?!!r.capture:!!r,i):ce(t,e,n,!1,r,i)}function ce(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=it(i)?!!i.capture:!!i;if(s&&!Qt)return null;var a=ve(t);if(a||(t[se]=a=new re(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=ye,e=Qt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Yt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(pe(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function he(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)he(t,e[o],n,r,i);return null}return n=ge(n),t&&t[Zt]?t.wa(e,n,it(r)?!!r.capture:!!r,i):ce(t,e,n,!0,r,i)}function le(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)le(t,e[o],n,r,i);else r=it(r)?!!r.capture:!!r,n=ge(n),t&&t[Zt]?(t=t.c,(e=String(e).toString())in t.a&&(-1<(n=oe(o=t.a[e],n,r,i))&&(ne(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=ve(t))&&(e=t.a[e.toString()],t=-1,e&&(t=oe(e,n,r,i)),(n=-1<t?e[t]:null)&&fe(n))}function fe(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Zt])ie(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(pe(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ve(e))?(ie(n,t),0==n.b&&(n.src=null,e[se]=null)):ne(t)}}}function pe(t){return t in ae?ae[t]:ae[t]="on"+t}function de(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&fe(t),n.call(r,e)}function ye(t,e){if(t.Y)return!0;if(!Qt){if(!e)t:{e=["window","event"];for(var n=et,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return de(t,e=new $t(e,this))}return de(t,new $t(e,this))}function ve(t){return(t=t[se])instanceof re?t:null}var me="__closure_events_fn_"+(1e9*Math.random()>>>0);function ge(t){return"function"==typeof t?t:(t[me]||(t[me]=function(e){return t.handleEvent(e)}),t[me])}function be(){pt.call(this),this.c=new re(this),this.J=this,this.C=null}function we(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new Xt(e,t);else if(e instanceof Xt)e.target=e.target||t;else{var i=e;At(e=new Xt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=Ie(s,r,!0,e)&&i}if(i=Ie(s=e.a=t,r,!0,e)&&i,i=Ie(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Ie(s=e.a=n[o],r,!1,e)&&i}function Ie(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&ie(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}ft(be,pt),be.prototype[Zt]=!0,(J=be.prototype).addEventListener=function(t,e,n,r){ue(this,t,e,n,r)},J.removeEventListener=function(t,e,n,r){le(this,t,e,n,r)},J.G=function(){if(be.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)ne(n[r]);delete e.a[t],e.b--}}this.C=null},J.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},J.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Ee=et.JSON.stringify;function Te(){this.b=this.a=null}var _e,Se=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())((function(){return new De}),(function(t){t.reset()}));function Ne(){var t=Oe,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function De(){this.next=this.b=this.a=null}function Ae(t){et.setTimeout((function(){throw t}),0)}function Ce(t,e){_e||function(){var t=et.Promise.resolve(void 0);_e=function(){t.then(Re)}}(),ke||(_e(),ke=!0),Oe.add(t,e)}Te.prototype.add=function(t,e){var n=Se.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},De.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},De.prototype.reset=function(){this.next=this.b=this.a=null};var ke=!1,Oe=new Te;function Re(){for(var t;t=Ne();){try{t.a.call(t.b)}catch(n){Ae(n)}var e=Se;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}ke=!1}function xe(t,e){be.call(this),this.b=t||1,this.a=e||et,this.f=ct(this.Za,this),this.g=lt()}function Le(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Pe(t,e,n){if("function"==typeof t)n&&(t=ct(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=ct(t.handleEvent,t)}return 2147483647<Number(e)?-1:et.setTimeout(t,e||0)}function Fe(t){t.a=Pe((function(){t.a=null,t.c&&(t.c=!1,Fe(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}ft(xe,be),(J=xe.prototype).aa=!1,J.M=null,J.Za=function(){if(this.aa){var t=lt()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),we(this,"tick"),this.aa&&(Le(this),this.start()))}},J.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=lt())},J.G=function(){xe.X.G.call(this),Le(this),delete this.a};var Me=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}X(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:Fe(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(et.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(pt);function Ve(t){pt.call(this),this.b=t,this.a={}}ft(Ve,pt);var Ue=[];function qe(t,e,n,r){Array.isArray(n)||(n&&(Ue[0]=n.toString()),n=Ue);for(var i=0;i<n.length;i++){var o=ue(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Be(t){St(t.a,(function(t,e){this.a.hasOwnProperty(e)&&fe(t)}),t),t.a={}}function je(){this.a=!0}function Ke(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Ee(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}Ve.prototype.G=function(){Ve.X.G.call(this),Be(this)},Ve.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},je.prototype.info=function(){};var Ge={},ze=null;function He(){return ze=ze||new be}function Qe(t){Xt.call(this,Ge.Fa,t)}function We(t){var e=He();we(e,new Qe(e,t))}function Ye(t,e){Xt.call(this,Ge.STAT_EVENT,t),this.stat=e}function Xe(t){var e=He();we(e,new Ye(e,t))}function $e(t){Xt.call(this,Ge.Ga,t)}function Je(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return et.setTimeout((function(){t()}),e)}Ge.Fa="serverreachability",ft(Qe,Xt),Ge.STAT_EVENT="statevent",ft(Ye,Xt),Ge.Ga="timingevent",ft($e,Xt);var Ze={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},tn={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function en(){}function nn(t){var e;return(e=t.a)||(e=t.a={}),e}function rn(){}en.prototype.a=null;var on,sn={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function an(){Xt.call(this,"d")}function un(){Xt.call(this,"c")}function cn(){}function hn(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new Ve(this),this.P=ln,t=Pt?125:void 0,this.R=new xe(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}ft(an,Xt),ft(un,Xt),ft(cn,en),on=new cn;var ln=45e3,fn={},pn={};function dn(t,e,n){t.H=1,t.i=Fn(kn(e)),t.j=n,t.I=!0,yn(t,null)}function yn(t,e){t.u=lt(),gn(t),t.l=kn(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),Yn(n.b,"t",r),t.D=0,t.a=Kr(t.g,t.g.C?e:null),0<t.O&&(t.F=new Me(ct(t.Ca,t,t.a),t.O)),qe(t.J,t.a,"readystatechange",t.Xa),e=t.B?Nt(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),We(1),function(t,e,n,r,i,o){t.info((function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.c,t.m,t.l,t.f,t.S,t.j)}function vn(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=mn(t,n);if(i==pn){4==e&&(t.h=4,Xe(14),r=!1),Ke(t.c,t.f,null,"[Incomplete Response]");break}if(i==fn){t.h=4,Xe(15),Ke(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}Ke(t.c,t.f,i,null),Tn(t,i)}4==e&&0==n.length&&(t.h=1,Xe(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Pr(e),e.F=!0,Xe(11))):(Ke(t.c,t.f,n,"[Invalid Chunked Response]"),En(t),In(t))}function mn(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?pn:(n=Number(e.substring(n,r)),isNaN(n)?fn:(r+=1)+n>e.length?pn:(e=e.substr(r,n),t.D=r+n,e))}function gn(t){t.T=lt()+t.P,bn(t,t.P)}function bn(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Je(ct(t.Va,t),e)}function wn(t){t.o&&(et.clearTimeout(t.o),t.o=null)}function In(t){0==t.g.v||t.A||Vr(t.g,t)}function En(t){wn(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Le(t.R),Be(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Tn(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||nr(n.b,t)))if(n.I=t.N,!t.C&&nr(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(v){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Mr(n),Nr(n)}Lr(n),Xe(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=Je(ct(n.Sa,n),6e3));if(1>=er(n.b)&&n.ea){try{n.ea()}catch(v){}n.ea=void 0}}else qr(n,11)}else if((t.C||n.a==t)&&Mr(n),!gt(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(It(h,"spdy")||It(h,"quic")||It(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(rr(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,Pn(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=lt()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var p=t;if((u=n).la=jr(u,u.C?u.ga:null,u.fa),p.C){ir(u.b,p);var d=p,y=u.D;y&&d.setTimeout(y),d.o&&(wn(d),gn(d)),u.a=p}else xr(u);0<n.g.length&&Cr(n)}else"stop"!=i[0]&&"close"!=i[0]||qr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?qr(n,7):Sr(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);We(4)}catch(v){}}function _n(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(rt(t)||"string"==typeof t)yt(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(rt(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(rt(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Sn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Sn)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Nn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Dn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Dn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Dn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(J=hn.prototype).setTimeout=function(t){this.P=t},J.Xa=function(t){t=t.target;var e=this.F;e&&3==Ir(t)?e.f():this.Ca(t)},J.Ca=function(t){try{if(t==this.a)t:{var e=Ir(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!Pt&&!this.a.$())){this.A||4!=e||7==n||We(8==n||0>=r?3:2),wn(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!gt(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,Xe(12),En(this),In(this);break t}Ke(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Tn(this,u)}this.I?(vn(this,e,o),Pt&&this.b&&3==e&&(qe(this.J,this.R,"tick",this.Wa),this.R.start())):(Ke(this.c,this.f,o,null),Tn(this,o)),4==e&&En(this),this.b&&!this.A&&(4==e?Vr(this.g,this):(this.b=!1,gn(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,Xe(12)):(this.h=0,Xe(13)),En(this),In(this)}}}catch(c){}},J.Wa=function(){if(this.a){var t=Ir(this.a),e=this.a.$();this.D<e.length&&(wn(this),vn(this,t,e),this.b&&4!=t&&gn(this))}},J.cancel=function(){this.A=!0,En(this)},J.Va=function(){this.o=null;var t=lt();0<=t-this.T?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(We(3),Xe(17)),En(this),this.h=2,In(this)):bn(this,this.T-t)},(J=Sn.prototype).K=function(){Nn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},J.L=function(){return Nn(this),this.a.concat()},J.get=function(t,e){return Dn(this.b,t)?this.b[t]:e},J.set=function(t,e){Dn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},J.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var An=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Cn(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Cn){this.a=void 0!==e?e:t.a,On(this,t.f),this.j=t.j,Rn(this,t.c),xn(this,t.h),this.g=t.g,e=t.b;var n=new zn;n.c=e.c,e.a&&(n.a=new Sn(e.a),n.b=e.b),Ln(this,n),this.i=t.i}else t&&(n=String(t).match(An))?(this.a=!!e,On(this,n[1]||"",!0),this.j=Mn(n[2]||""),Rn(this,n[3]||"",!0),xn(this,n[4]),this.g=Mn(n[5]||"",!0),Ln(this,n[6]||"",!0),this.i=Mn(n[7]||"")):(this.a=!!e,this.b=new zn(null,this.a))}function kn(t){return new Cn(t)}function On(t,e,n){t.f=n?Mn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Rn(t,e,n){t.c=n?Mn(e,!0):e}function xn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ln(t,e,n){e instanceof zn?(t.b=e,function(t,e){e&&!t.f&&(Hn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Qn(this,e),Yn(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=Vn(e,Kn)),t.b=new zn(e,t.a))}function Pn(t,e,n){t.b.set(e,n)}function Fn(t){return Pn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^lt()).toString(36)),t}function Mn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Vn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Un),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Un(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Cn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Vn(e,qn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Vn(e,qn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Vn(n,"/"==n.charAt(0)?jn:Bn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Vn(n,Gn)),t.join("")};var qn=/[#\/\?@]/g,Bn=/[#\?:]/g,jn=/[#\?]/g,Kn=/[#\?@]/g,Gn=/#/g;function zn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Hn(t){t.a||(t.a=new Sn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Qn(t,e){Hn(t),e=Xn(t,e),Dn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Dn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Nn(t)))}function Wn(t,e){return Hn(t),e=Xn(t,e),Dn(t.a.b,e)}function Yn(t,e,n){Qn(t,e),0<n.length&&(t.c=null,t.a.set(Xn(t,e),mt(n)),t.b+=n.length)}function Xn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(J=zn.prototype).add=function(t,e){Hn(this),this.c=null,t=Xn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},J.forEach=function(t,e){Hn(this),this.a.forEach((function(n,r){yt(n,(function(n){t.call(e,n,r,this)}),this)}),this)},J.L=function(){Hn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},J.K=function(t){Hn(this);var e=[];if("string"==typeof t)Wn(this,t)&&(e=vt(e,this.a.get(Xn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=vt(e,t[n])}return e},J.set=function(t,e){return Hn(this),this.c=null,Wn(this,t=Xn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},J.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},J.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var $n=function(t,e){this.b=t,this.a=e};function Jn(t){this.g=t||Zn,et.PerformanceNavigationTiming?t=0<(t=et.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(et.ia&&et.ia.ya&&et.ia.ya()&&et.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var Zn=10;function tr(t){return!!t.b||!!t.a&&t.a.size>=t.f}function er(t){return t.b?1:t.a?t.a.size:0}function nr(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function rr(t,e){t.a?t.a.add(e):t.b=e}function ir(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function or(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=$(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.s)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return mt(t.c)}function sr(){}function ar(){this.a=new sr}function ur(t,e,n){var r=n||"";try{_n(t,(function(t,n){var i=t;it(t)&&(i=Ee(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(ed){throw e.push(r+"type="+encodeURIComponent("_badmap")),ed}}function cr(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}Jn.prototype.cancel=function(){var t,e;if(this.c=or(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=$(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},sr.prototype.stringify=function(t){return et.JSON.stringify(t,void 0)},sr.prototype.parse=function(t){return et.JSON.parse(t,void 0)};var hr=et.JSON.parse;function lr(t){be.call(this),this.headers=new Sn,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=fr,this.D=this.F=!1}ft(lr,be);var fr="",pr=/^https?$/i,dr=["POST","PUT"];function yr(t){return"content-type"==t.toLowerCase()}function vr(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,mr(t),br(t)}function mr(t){t.u||(t.u=!0,we(t,"complete"),we(t,"error"))}function gr(t){if(t.b&&void 0!==tt&&(!t.s[1]||4!=Ir(t)||2!=t.W()))if(t.l&&4==Ir(t))Pe(t.za,0,t);else if(we(t,"readystatechange"),4==Ir(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(An)[1]||null;if(!o&&et.self&&et.self.location){var s=et.self.location.protocol;o=s.substr(0,s.length-1)}i=!pr.test(o?o.toLowerCase():"")}e=i}if(e)we(t,"complete"),we(t,"success");else{t.h=6;try{var a=2<Ir(t)?t.a.statusText:""}catch(u){a=""}t.f=a+" ["+t.W()+"]",mr(t)}}finally{br(t)}}}function br(t,e){if(t.a){wr(t);var n=t.a,r=t.s[0]?nt:null;t.a=null,t.s=null,e||we(t,"ready");try{n.onreadystatechange=r}catch(ed){}}}function wr(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(et.clearTimeout(t.m),t.m=null)}function Ir(t){return t.a?t.a.readyState:0}function Er(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return St(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Pn(t,e,n))}function Tr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function _r(t){this.pa=0,this.g=[],this.c=new je,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Tr("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Tr("baseRetryDelayMs",5e3,t),this.Ra=Tr("retryDelaySeedMs",1e4,t),this.Ma=Tr("forwardChannelMaxRetries",2,t),this.ma=Tr("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new Jn(t&&t.concurrentRequestLimit),this.ka=new ar,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Sr(t){if(Dr(t),3==t.v){var e=t.R++,n=kn(t.B);Pn(n,"SID",t.J),Pn(n,"RID",e),Pn(n,"TYPE","terminate"),Or(t,n),(e=new hn(t,t.c,e,void 0)).H=2,e.i=Fn(kn(n)),n=!1,et.navigator&&et.navigator.sendBeacon&&(n=et.navigator.sendBeacon(e.i.toString(),"")),!n&&et.Image&&((new Image).src=e.i,n=!0),n||(e.a=Kr(e.g,null),e.a.ba(e.i)),e.u=lt(),gn(e)}Br(t)}function Nr(t){t.a&&(Pr(t),t.a.cancel(),t.a=null)}function Dr(t){Nr(t),t.j&&(et.clearTimeout(t.j),t.j=null),Mr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&et.clearTimeout(t.h),t.h=null)}function Ar(t,e){t.g.push(new $n(t.Oa++,e)),3==t.v&&Cr(t)}function Cr(t){tr(t.b)||t.h||(t.h=!0,Ce(t.Ba,t),t.u=0)}function kr(t,e){var n;n=e?e.f:t.R++;var r=kn(t.B);Pn(r,"SID",t.J),Pn(r,"RID",n),Pn(r,"AID",t.P),Or(t,r),t.i&&t.l&&Er(r,t.i,t.l),n=new hn(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Rr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),rr(t.b,n),dn(n,r,e)}function Or(t,e){t.f&&_n({},(function(t,n){Pn(e,n,t)}))}function Rr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?ct(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{ur(h,s,"req"+c+"_")}catch(l){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function xr(t){t.a||t.j||(t.T=1,Ce(t.Aa,t),t.o=0)}function Lr(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=Je(ct(t.Aa,t),Ur(t,t.o)),t.o++,!0)}function Pr(t){null!=t.s&&(et.clearTimeout(t.s),t.s=null)}function Fr(t){t.a=new hn(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=kn(t.la);Pn(e,"RID","rpc"),Pn(e,"SID",t.J),Pn(e,"CI",t.H?"0":"1"),Pn(e,"AID",t.P),Or(t,e),Pn(e,"TYPE","xmlhttp"),t.i&&t.l&&Er(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Fn(kn(e)),n.j=null,n.I=!0,yn(n,t)}function Mr(t){null!=t.m&&(et.clearTimeout(t.m),t.m=null)}function Vr(t,e){var n=null;if(t.a==e){Mr(t),Pr(t),t.a=null;var r=2}else{if(!nr(t.b,e))return;n=e.s,ir(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=lt()-e.u;var i=t.u;we(r=He(),new $e(r,n,e,i)),Cr(t)}else xr(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(er(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=Je(ct(t.Ba,t,e),Ur(t,t.u)),t.u++,0)))}(t,e)||2==r&&Lr(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:qr(t,5);break;case 4:qr(t,10);break;case 3:qr(t,6);break;default:qr(t,2)}}function Ur(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function qr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=ct(t.Ya,t);n||(n=new Cn("//www.google.com/images/cleardot.gif"),et.location&&"http"==et.location.protocol||On(n,"https"),Fn(n)),function(t,e){var n=new je;if(et.Image){var r=new Image;r.onload=ht(cr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=ht(cr,n,r,"TestLoadImage: error",!1,e),r.onabort=ht(cr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=ht(cr,n,r,"TestLoadImage: timeout",!1,e),et.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Xe(2);t.v=0,t.f&&t.f.ra(e),Br(t),Dr(t)}function Br(t){t.v=0,t.I=-1,t.f&&(0==or(t.b).length&&0==t.g.length||(t.b.c.length=0,mt(t.g),t.g.length=0),t.f.qa())}function jr(t,e,n){var r=function(t){return t instanceof Cn?kn(t):new Cn(t,void 0)}(n);if(""!=r.c)e&&Rn(r,e+"."+r.c),xn(r,r.h);else{var i=et.location;r=function(t,e,n,r){var i=new Cn(null,void 0);return t&&On(i,t),e&&Rn(i,e),n&&xn(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&St(t.V,(function(t,e){Pn(r,e,t)})),e=t.A,n=t.na,e&&n&&Pn(r,e,n),Pn(r,"VER",t.ha),Or(t,r),r}function Kr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new lr(t.Na)).F=t.C,e}function Gr(){}function zr(){if(xt&&!(10<=Number(Ht)))throw Error("Environmental error: no available transport.")}function Hr(t,e){be.call(this),this.a=new _r(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!gt(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!gt(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Yr(this)}function Qr(t){an.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Wr(){un.call(this),this.status=1}function Yr(t){this.a=t}(J=lr.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?nn(this.H):nn(on),this.a.onreadystatechange=ct(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void vr(this,o)}t=n||"";var i=new Sn(this.headers);r&&_n(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=yr,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=et.FormData&&t instanceof et.FormData,!(0<=dt(dr,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{wr(this),0<this.o&&((this.D=function(t){return xt&&Gt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=ct(this.xa,this)):this.m=Pe(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){vr(this,o)}},J.xa=function(){void 0!==tt&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,we(this,"timeout"),this.abort(8))},J.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,we(this,"complete"),we(this,"abort"),br(this))},J.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),br(this,!0)),lr.X.G.call(this)},J.za=function(){this.j||(this.A||this.l||this.g?gr(this):this.Ua())},J.Ua=function(){gr(this)},J.W=function(){try{return 2<Ir(this)?this.a.status:-1}catch(Ot){return-1}},J.$=function(){try{return this.a?this.a.responseText:""}catch(Ot){return""}},J.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),hr(e)}},J.ua=function(){return this.h},J.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(J=_r.prototype).ha=8,J.v=1,J.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new hn(this,this.c,t,void 0),r=this.l;if(this.O&&(r?At(r=Nt(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Rr(this,n,e),Pn(i=kn(this.B),"RID",t),Pn(i,"CVER",22),this.A&&Pn(i,"X-HTTP-Session-Id",this.A),Or(this,i),this.i&&r&&Er(i,this.i,r),rr(this.b,n),this.Ia&&Pn(i,"TYPE","init"),this.da?(Pn(i,"$req",e),Pn(i,"SID","null"),n.U=!0,dn(n,i,null)):dn(n,i,e),this.v=2}}else 3==this.v&&(t?kr(this,t):0==this.g.length||tr(this.b)||kr(this))},J.Aa=function(){if(this.j=null,Fr(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=Je(ct(this.Ta,this),t)}},J.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Xe(10),Nr(this),Fr(this))},J.Sa=function(){null!=this.m&&(this.m=null,Nr(this),Lr(this),Xe(19))},J.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),Xe(2)):(this.c.info("Failed to ping google.com"),Xe(1))},(J=Gr.prototype).ta=function(){},J.sa=function(){},J.ra=function(){},J.qa=function(){},J.Ja=function(){},zr.prototype.a=function(t,e){return new Hr(t,e)},ft(Hr,be),Hr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;Xe(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=jr(t,null,t.fa),Cr(t)},Hr.prototype.close=function(){Sr(this.a)},Hr.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Ar(this.a,e)}else this.l?((e={}).__data__=Ee(t),Ar(this.a,e)):Ar(this.a,t)},Hr.prototype.G=function(){this.a.f=null,delete this.f,Sr(this.a),delete this.a,Hr.X.G.call(this)},ft(Qr,an),ft(Wr,un),ft(Yr,Gr),Yr.prototype.ta=function(){we(this.a,"a")},Yr.prototype.sa=function(t){we(this.a,new Qr(t))},Yr.prototype.ra=function(t){we(this.a,new Wr(t))},Yr.prototype.qa=function(){we(this.a,"b")},zr.prototype.createWebChannel=zr.prototype.a,Hr.prototype.send=Hr.prototype.h,Hr.prototype.open=Hr.prototype.g,Hr.prototype.close=Hr.prototype.close,Ze.NO_ERROR=0,Ze.TIMEOUT=8,Ze.HTTP_ERROR=6,tn.COMPLETE="complete",rn.EventType=sn,sn.OPEN="a",sn.CLOSE="b",sn.ERROR="c",sn.MESSAGE="d",be.prototype.listen=be.prototype.va,lr.prototype.listenOnce=lr.prototype.wa,lr.prototype.getLastError=lr.prototype.Qa,lr.prototype.getLastErrorCode=lr.prototype.ua,lr.prototype.getStatus=lr.prototype.W,lr.prototype.getResponseJson=lr.prototype.Pa,lr.prototype.getResponseText=lr.prototype.$,lr.prototype.send=lr.prototype.ba;var Xr=Ze,$r=tn,Jr=Ge,Zr=10,ti=11,ei=rn,ni=lr,ri=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();ri.o=-1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ii={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},oi=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return e(n,t),n}(Error),si=new L("@firebase/firestore");function ai(){return si.logLevel}function ui(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(si.logLevel<=N.DEBUG){var r=e.map(li);si.debug.apply(si,a(["Firestore (8.4.2): "+t],r))}}function ci(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(si.logLevel<=N.ERROR){var r=e.map(li);si.error.apply(si,a(["Firestore (8.4.2): "+t],r))}}function hi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(si.logLevel<=N.WARN){var r=e.map(li);si.warn.apply(si,a(["Firestore (8.4.2): "+t],r))}}function li(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(n){return t}
/**
  * @license
  * Copyright 2020 Google LLC
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *   http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */var e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fi(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.4.2) INTERNAL ASSERTION FAILED: "+t;throw ci(e),new Error(e)}function pi(t,e){t||fi()}function di(t,e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yi(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vi=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=yi(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function mi(t,e){return t<e?-1:t>e?1:0}function gi(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function bi(t){return t+"\0"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var wi=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new oi(ii.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new oi(ii.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new oi(ii.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new oi(ii.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?mi(this.nanoseconds,t.nanoseconds):mi(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Ii=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new wi(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ei(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ti(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function _i(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Si=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&fi(),void 0===n?n=t.length-e:n>t.length-e&&fi(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Ni=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.prototype.canonicalString=function(){return this.toArray().join("/")},n.prototype.toString=function(){return this.canonicalString()},n.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new oi(ii.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new n(r)},n.emptyPath=function(){return new n([])},n}(Si),Di=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ai=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.isValidIdentifier=function(t){return Di.test(t)},n.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},n.prototype.toString=function(){return this.canonicalString()},n.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},n.keyField=function(){return new n(["__name__"])},n.fromServerFormat=function(t){for(var e=[],r="",i=0,o=function(){if(0===r.length)throw new oi(ii.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new oi(ii.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new oi(ii.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new oi(ii.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)},n.emptyPath=function(){return new n([])},n}(Si),Ci=function(){function t(t){this.fields=t,t.sort(Ai.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return gi(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),ki=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return mi(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();ki.EMPTY_BYTE_STRING=new ki("");var Oi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ri(t){if(pi(!!t),"string"==typeof t){var e=0,n=Oi.exec(t);if(pi(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:xi(t.seconds),nanos:xi(t.nanos)}}function xi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Li(t){return"string"==typeof t?ki.fromBase64String(t):ki.fromUint8Array(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Fi(t){var e=t.mapValue.fields.__previous_value__;return Pi(e)?Fi(e):e}function Mi(t){var e=Ri(t.mapValue.fields.__local_write_time__.timestampValue);return new wi(e.seconds,e.nanos)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vi(t){return null==t}function Ui(t){return 0===t&&1/t==-1/0}function qi(t){return"number"==typeof t&&Number.isInteger(t)&&!Ui(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Ni.fromString(e))},t.fromName=function(e){return new t(Ni.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Ni.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Ni.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Ni(e.slice()))},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ji(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Pi(t)?4:10:fi()}function Ki(t,e){var n,r=ji(t);if(r!==ji(e))return!1;switch(r){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Mi(t).isEqual(Mi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ri(t.timestampValue),r=Ri(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return n=e,Li(t.bytesValue).isEqual(Li(n.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return xi(t.geoPointValue.latitude)===xi(e.geoPointValue.latitude)&&xi(t.geoPointValue.longitude)===xi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return xi(t.integerValue)===xi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=xi(t.doubleValue),r=xi(e.doubleValue);return n===r?Ui(n)===Ui(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return gi(t.arrayValue.values||[],e.arrayValue.values||[],Ki);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Ei(n)!==Ei(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ki(n[i],r[i])))return!1;return!0}(t,e);default:return fi()}}function Gi(t,e){return void 0!==(t.values||[]).find((function(t){return Ki(t,e)}))}function zi(t,e){var n,r,i,o,s=ji(t),a=ji(e);if(s!==a)return mi(s,a);switch(s){case 0:return 0;case 1:return mi(t.booleanValue,e.booleanValue);case 2:return r=e,i=xi((n=t).integerValue||n.doubleValue),o=xi(r.integerValue||r.doubleValue),i<o?-1:i>o?1:i===o?0:isNaN(i)?isNaN(o)?0:-1:1;case 3:return Hi(t.timestampValue,e.timestampValue);case 4:return Hi(Mi(t),Mi(e));case 5:return mi(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Li(t),r=Li(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=mi(n[i],r[i]);if(0!==o)return o}return mi(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=mi(xi(t.latitude),xi(e.latitude));return 0!==n?n:mi(xi(t.longitude),xi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=zi(n[i],r[i]);if(o)return o}return mi(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=mi(r[s],o[s]);if(0!==a)return a;var u=zi(n[r[s]],i[o[s]]);if(0!==u)return u}return mi(r.length,o.length)}(t.mapValue,e.mapValue);default:throw fi()}}function Hi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return mi(t,e);var n=Ri(t),r=Ri(e),i=mi(n.seconds,r.seconds);return 0!==i?i:mi(n.nanos,r.nanos)}function Qi(t){return Wi(t)}function Wi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(e=t.timestampValue,"time("+(n=Ri(e)).seconds+","+n.nanos+")"):"stringValue"in t?t.stringValue:"bytesValue"in t?Li(t.bytesValue).toBase64():"referenceValue"in t?(i=t.referenceValue,Bi.fromName(i).toString()):"geoPointValue"in t?"geo("+(r=t.geoPointValue).latitude+","+r.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Wi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Wi(t.fields[o])}return e+"}"}(t.mapValue):fi();var e,n,r,i}function Yi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Xi(t){return!!t&&"integerValue"in t}function $i(t){return!!t&&"arrayValue"in t}function Ji(t){return!!t&&"nullValue"in t}function Zi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function to(t){return!!t&&"mapValue"in t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eo=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(Ai.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach((function(t,n){t?e.set(n,t):e.delete(n)}))},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return Ki(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===ji(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=to(o)?Object.assign({},o.mapValue.fields):{};return n.forEach((function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)})),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(Ai.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!to(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function no(t){var e=[];return Ti(t.fields||{},(function(t,n){var r=new Ai([t]);if(to(n)){var i=no(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new Ci(e)}var ro=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Ii.min(),eo.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,eo.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,eo.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=eo.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=eo.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),io=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oo(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new io(t,e,n,r,i,o,s)}function so(t){var e=di(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return(e=t).field.canonicalString()+e.op.toString()+Qi(e.value);var e})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.canonicalString()+e.dir;var e})).join(","),Vi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=wo(e.startAt)),e.endAt&&(n+="|ub:",n+=wo(e.endAt)),e.h=n}return e.h}function ao(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Eo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Ki(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!_o(t.startAt,e.startAt)&&_o(t.endAt,e.endAt)}function uo(t){return Bi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var co=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return e(n,t),n.create=function(t,e,r){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,r):new ho(t,e,r):"array-contains"===e?new yo(t,r):"in"===e?new vo(t,r):"not-in"===e?new mo(t,r):"array-contains-any"===e?new go(t,r):new n(t,e,r)},n.l=function(t,e,n){return"in"===e?new lo(t,n):new fo(t,n)},n.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(zi(e,this.value)):null!==e&&ji(this.value)===ji(e)&&this.m(zi(e,this.value))},n.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return fi()}},n.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},n}((function(){})),ho=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Bi.fromName(r.referenceValue),i}return e(n,t),n.prototype.matches=function(t){var e=Bi.comparator(t.key,this.key);return this.m(e)},n}(co),lo=function(t){function n(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=po("in",n),r}return e(n,t),n.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},n}(co),fo=function(t){function n(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=po("not-in",n),r}return e(n,t),n.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},n}(co);function po(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return Bi.fromName(t.referenceValue)}))}var yo=function(t){function n(e,n){return t.call(this,e,"array-contains",n)||this}return e(n,t),n.prototype.matches=function(t){var e=t.data.field(this.field);return $i(e)&&Gi(e.arrayValue,this.value)},n}(co),vo=function(t){function n(e,n){return t.call(this,e,"in",n)||this}return e(n,t),n.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Gi(this.value.arrayValue,e)},n}(co),mo=function(t){function n(e,n){return t.call(this,e,"not-in",n)||this}return e(n,t),n.prototype.matches=function(t){if(Gi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Gi(this.value.arrayValue,e)},n}(co),go=function(t){function n(e,n){return t.call(this,e,"array-contains-any",n)||this}return e(n,t),n.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!$i(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Gi(e.value.arrayValue,t)}))},n}(co),bo=function(t,e){this.position=t,this.before=e};function wo(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return Qi(t)})).join(",")}var Io=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Eo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function To(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Bi.comparator(Bi.fromName(s.referenceValue),n.key):zi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function _o(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Ki(t.position[n],e.position[n]))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var So=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function No(t,e,n,r,i,o,s,a){return new So(t,e,n,r,i,o,s,a)}function Do(t){return new So(t)}function Ao(t){return!Vi(t.limit)&&"F"===t.limitType}function Co(t){return!Vi(t.limit)&&"L"===t.limitType}function ko(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Oo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Ro(t){return null!==t.collectionGroup}function xo(t){var e=di(t);if(null===e.p){e.p=[];var n=Oo(e),r=ko(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Io(n)),e.p.push(new Io(Ai.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Io(Ai.keyField(),u))}}}return e.p}function Lo(t){var e=di(t);if(!e.T)if("F"===e.limitType)e.T=oo(e.path,e.collectionGroup,xo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=xo(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Io(o.field,s))}var a=e.endAt?new bo(e.endAt.position,!e.endAt.before):null,u=e.startAt?new bo(e.startAt.position,!e.startAt.before):null;e.T=oo(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function Po(t,e,n){return new So(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Fo(t,e){return ao(Lo(t),Lo(e))&&t.limitType===e.limitType}function Mo(t){return so(Lo(t))+"|lt:"+t.limitType}function Vo(t){return"Query(target="+(e=Lo(t),n=e.path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=", filters: ["+e.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Qi(e.value);var e})).join(", ")+"]"),Vi(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=", orderBy: ["+e.orderBy.map((function(t){return(e=t).field.canonicalString()+" ("+e.dir+")";var e})).join(", ")+"]"),e.startAt&&(n+=", startAt: "+wo(e.startAt)),e.endAt&&(n+=", endAt: "+wo(e.endAt)),"Target("+n+"); limitType=")+t.limitType+")";var e,n}function Uo(t,e){return e.isFoundDocument()&&(n=t,i=(r=e).key.path,null!==n.collectionGroup?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):Bi.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i))&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!To(t.startAt,xo(t),e)||t.endAt&&To(t.endAt,xo(t),e))}(t,e);var n,r,i}function qo(t){return function(e,n){for(var r=!1,i=0,o=xo(t);i<o.length;i++){var s=o[i],a=Bo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Bo(t,e,n){var r,i,o,s,a=t.field.isKeyField()?Bi.comparator(e.key,n.key):(r=t.field,i=n,o=e.data.field(r),s=i.data.field(r),null!==o&&null!==s?zi(o,s):fi());switch(t.dir){case"asc":return a;case"desc":return-1*a;default:return fi()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ui(e)?"-0":e}}function Ko(t){return{integerValue:""+t}}function Go(t,e){return qi(e)?Ko(e):jo(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zo=function(){this._=void 0};function Ho(t,e,n){return t instanceof Yo?(i=e,o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:(r=n).seconds,nanos:r.nanoseconds}}}},i&&(o.fields.__previous_value__=i),{mapValue:o}):t instanceof Xo?$o(t,e):t instanceof Jo?Zo(t,e):function(t,e){var n=Wo(t,e),r=es(n)+es(t.A);return Xi(n)&&Xi(t.A)?Ko(r):jo(t.R,r)}(t,e);var r,i,o}function Qo(t,e,n){return t instanceof Xo?$o(t,e):t instanceof Jo?Zo(t,e):n}function Wo(t,e){return t instanceof ts?Xi(r=e)||(n=r)&&"doubleValue"in n?e:{integerValue:0}:null;var n,r}var Yo=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n}(zo),Xo=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return e(n,t),n}(zo);function $o(t,e){for(var n=ns(e),r=function(t){n.some((function(e){return Ki(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Jo=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return e(n,t),n}(zo);function Zo(t,e){for(var n=ns(e),r=function(t){n=n.filter((function(e){return!Ki(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ts=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return e(n,t),n}(zo);function es(t){return xi(t.integerValue||t.doubleValue)}function ns(t){return $i(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rs=function(t,e){this.field=t,this.transform=e},is=function(t,e){this.version=t,this.transformResults=e},os=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function ss(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var as=function(){};function us(t,e,n){var r,i,o,s,a;t instanceof ps?(i=e,o=n,s=(r=t).value.clone(),a=vs(r.fieldTransforms,i,o.transformResults),s.setAll(a),i.convertToFoundDocument(o.version,s).setHasCommittedMutations()):t instanceof ds?function(t,e,n){if(ss(t.precondition,e)){var r=vs(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(ys(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function cs(t,e,n){var r;t instanceof ps?function(t,e,n){if(ss(t.precondition,e)){var r=t.value.clone(),i=ms(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(fs(e),r).setHasLocalMutations()}}(t,e,n):t instanceof ds?function(t,e,n){if(ss(t.precondition,e)){var r=ms(t.fieldTransforms,n,e),i=e.data;i.setAll(ys(t)),i.setAll(r),e.convertToFoundDocument(fs(e),i).setHasLocalMutations()}}(t,e,n):(r=e,ss(t.precondition,r)&&r.convertToNoDocument(Ii.min()))}function hs(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Wo(o.transform,s||null);null!=a&&(null==n&&(n=eo.empty()),n.set(o.field,a))}return n||null}function ls(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&gi(n,r,(function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof Xo&&o instanceof Xo||i instanceof Jo&&o instanceof Jo?gi(i.elements,o.elements,Ki):i instanceof ts&&o instanceof ts?Ki(i.A,o.A):i instanceof Yo&&o instanceof Yo);var n,r,i,o}))))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function fs(t){return t.isFoundDocument()?t.version:Ii.min()}var ps=function(t){function n(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return e(n,t),n}(as),ds=function(t){function n(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return e(n,t),n}(as);function ys(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function vs(t,e,n){var r=new Map;pi(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Qo(s,a,n[i]))}return r}function ms(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Ho(a,u,e))}return r}var gs,bs,ws=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return e(n,t),n}(as),Is=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return e(n,t),n}(as),Es=function(t){this.count=t};function Ts(t){switch(t){case ii.OK:return fi();case ii.CANCELLED:case ii.UNKNOWN:case ii.DEADLINE_EXCEEDED:case ii.RESOURCE_EXHAUSTED:case ii.INTERNAL:case ii.UNAVAILABLE:case ii.UNAUTHENTICATED:return!1;case ii.INVALID_ARGUMENT:case ii.NOT_FOUND:case ii.ALREADY_EXISTS:case ii.PERMISSION_DENIED:case ii.FAILED_PRECONDITION:case ii.ABORTED:case ii.OUT_OF_RANGE:case ii.UNIMPLEMENTED:case ii.DATA_LOSS:return!0;default:return fi()}}function _s(t){if(void 0===t)return ci("GRPC error has no .code"),ii.UNKNOWN;switch(t){case gs.OK:return ii.OK;case gs.CANCELLED:return ii.CANCELLED;case gs.UNKNOWN:return ii.UNKNOWN;case gs.DEADLINE_EXCEEDED:return ii.DEADLINE_EXCEEDED;case gs.RESOURCE_EXHAUSTED:return ii.RESOURCE_EXHAUSTED;case gs.INTERNAL:return ii.INTERNAL;case gs.UNAVAILABLE:return ii.UNAVAILABLE;case gs.UNAUTHENTICATED:return ii.UNAUTHENTICATED;case gs.INVALID_ARGUMENT:return ii.INVALID_ARGUMENT;case gs.NOT_FOUND:return ii.NOT_FOUND;case gs.ALREADY_EXISTS:return ii.ALREADY_EXISTS;case gs.PERMISSION_DENIED:return ii.PERMISSION_DENIED;case gs.FAILED_PRECONDITION:return ii.FAILED_PRECONDITION;case gs.ABORTED:return ii.ABORTED;case gs.OUT_OF_RANGE:return ii.OUT_OF_RANGE;case gs.UNIMPLEMENTED:return ii.UNIMPLEMENTED;case gs.DATA_LOSS:return ii.DATA_LOSS;default:return fi()}}(bs=gs||(gs={}))[bs.OK=0]="OK",bs[bs.CANCELLED=1]="CANCELLED",bs[bs.UNKNOWN=2]="UNKNOWN",bs[bs.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bs[bs.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bs[bs.NOT_FOUND=5]="NOT_FOUND",bs[bs.ALREADY_EXISTS=6]="ALREADY_EXISTS",bs[bs.PERMISSION_DENIED=7]="PERMISSION_DENIED",bs[bs.UNAUTHENTICATED=16]="UNAUTHENTICATED",bs[bs.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bs[bs.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bs[bs.ABORTED=10]="ABORTED",bs[bs.OUT_OF_RANGE=11]="OUT_OF_RANGE",bs[bs.UNIMPLEMENTED=12]="UNIMPLEMENTED",bs[bs.INTERNAL=13]="INTERNAL",bs[bs.UNAVAILABLE=14]="UNAVAILABLE",bs[bs.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ss=function(){function t(t,e){this.comparator=t,this.root=e||Ds.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Ds.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ds.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Ns(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Ns(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Ns(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Ns(this.root,t,this.comparator,!0)},t}(),Ns=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Ds=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw fi();if(this.right.isRed())throw fi();var t=this.left.check();if(t!==this.right.check())throw fi();return t+(this.isRed()?0:1)},t}();Ds.EMPTY=null,Ds.RED=!0,Ds.BLACK=!1,Ds.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw fi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw fi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw fi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw fi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw fi()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Ds(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var As=function(){function t(t){this.comparator=t,this.data=new Ss(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Cs(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Cs(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Cs=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),ks=new Ss(Bi.comparator);function Os(){return ks}var Rs=new Ss(Bi.comparator);function xs(){return Rs}var Ls=new Ss(Bi.comparator);var Ps=new As(Bi.comparator);function Fs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ps,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ms=new As(mi);function Vs(){return Ms}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Us=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,qs.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Ii.min(),r,Vs(),Os(),Fs())},t}(),qs=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(ki.EMPTY_BYTE_STRING,n,Fs(),Fs(),Fs())},t}(),Bs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},js=function(t,e){this.targetId=t,this.V=e},Ks=function(t,e,n,r){void 0===n&&(n=ki.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Gs=function(){function t(){this.S=0,this.D=Qs(),this.C=ki.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Fs(),e=Fs(),n=Fs();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:fi()}})),new qs(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Qs()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),zs=function(){function t(t){this.W=t,this.G=new Map,this.H=Os(),this.J=Hs(),this.Y=new As(mi)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:fi()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(uo(i))if(0===n){var o=new Bi(i.path);this.tt(e,o,ro.newNoDocument(o,Ii.min()))}else pi(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&uo(o.target)){var s=new Bi(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,ro.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}}));var r=Fs();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new Us(t,n,this.Y,this.H,r);return this.H=Os(),this.J=Hs(),this.Y=new As(mi),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Gs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new As(mi),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||ui("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Gs),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Hs(){return new Ss(Bi.comparator)}function Qs(){return new Ss(Bi.comparator)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ws={asc:"ASCENDING",desc:"DESCENDING"},Ys={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Xs=function(t,e){this.databaseId=t,this.I=e};function $s(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Js(t,e){return t.I?e.toBase64():e.toUint8Array()}function Zs(t,e){return $s(t,e.toTimestamp())}function ta(t){return pi(!!t),Ii.fromTimestamp((e=Ri(t),new wi(e.seconds,e.nanos)));var e}function ea(t,e){return(n=t,new Ni(["projects",n.projectId,"databases",n.database])).child("documents").child(e).canonicalString();var n}function na(t){var e=Ni.fromString(t);return pi(Sa(e)),e}function ra(t,e){return ea(t.databaseId,e.path)}function ia(t,e){var n=na(e);if(n.get(1)!==t.databaseId.projectId)throw new oi(ii.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new oi(ii.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Bi(ua(n))}function oa(t,e){return ea(t.databaseId,e)}function sa(t){var e=na(t);return 4===e.length?Ni.emptyPath():ua(e)}function aa(t){return new Ni(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ua(t){return pi(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function ca(t,e,n){return{name:ra(t,e),fields:n.toProto().mapValue.fields}}function ha(t,e){var n,r,i;if(e instanceof ps)n={update:ca(t,e.key,e.value)};else if(e instanceof ws)n={delete:ra(t,e.key)};else if(e instanceof ds)n={update:ca(t,e.key,e.data),updateMask:_a(e.fieldMask)};else{if(!(e instanceof Is))return fi();n={verify:ra(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Yo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Xo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Jo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ts)return{fieldPath:e.field.canonicalString(),increment:n.A};throw fi()}(0,t)}))),e.precondition.isNone||(n.currentDocument=(r=t,void 0!==(i=e.precondition).updateTime?{updateTime:Zs(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:fi())),n}function la(t,e){var n,r=e.currentDocument?void 0!==(n=e.currentDocument).updateTime?os.updateTime(ta(n.updateTime)):void 0!==n.exists?os.exists(n.exists):os.none():os.none(),i=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)pi("REQUEST_TIME"===e.setToServerValue),n=new Yo;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new Xo(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new Jo(i)}else"increment"in e?n=new ts(t,e.increment):fi();var o=Ai.fromServerFormat(e.fieldPath);return new rs(o,n)}(t,e)})):[];if(e.update){e.update.name;var o=ia(t,e.update.name),s=new eo({mapValue:{fields:e.update.fields}});if(e.updateMask){var a=function(t){var e=t.fieldPaths||[];return new Ci(e.map((function(t){return Ai.fromServerFormat(t)})))}(e.updateMask);return new ds(o,s,a,r,i)}return new ps(o,s,r,i)}if(e.delete){var u=ia(t,e.delete);return new ws(u,r)}if(e.verify){var c=ia(t,e.verify);return new Is(c,r)}return fi()}function fa(t,e){return{documents:[oa(t,e.path)]}}function pa(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=oa(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=oa(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Zi(t.value))return{unaryFilter:{field:wa(t.field),op:"IS_NAN"}};if(Ji(t.value))return{unaryFilter:{field:wa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Zi(t.value))return{unaryFilter:{field:wa(t.field),op:"IS_NOT_NAN"}};if(Ji(t.value))return{unaryFilter:{field:wa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wa(t.field),op:ba(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return{field:wa((e=t).field),direction:ga(e.dir)};var e}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,a,u=(s=t,a=e.limit,s.I||Vi(a)?a:{value:a});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=va(e.startAt)),e.endAt&&(n.structuredQuery.endAt=va(e.endAt)),n}function da(t){var e=sa(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){pi(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=ya(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return new Io(Ia((e=t).field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction));var e})));var u,c,h=null;n.limit&&(u=n.limit,h=Vi(c="object"==typeof u?u.value:u)?null:c);var l=null;n.startAt&&(l=ma(n.startAt));var f=null;return n.endAt&&(f=ma(n.endAt)),No(e,i,a,s,h,"F",l,f)}function ya(t){return t?void 0!==t.unaryFilter?[Ta(t)]:void 0!==t.fieldFilter?[Ea(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return ya(t)})).reduce((function(t,e){return t.concat(e)})):fi():[]}function va(t){return{before:t.before,values:t.position}}function ma(t){var e=!!t.before,n=t.values||[];return new bo(n,e)}function ga(t){return Ws[t]}function ba(t){return Ys[t]}function wa(t){return{fieldPath:t.canonicalString()}}function Ia(t){return Ai.fromServerFormat(t.fieldPath)}function Ea(t){return co.create(Ia(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return fi()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ta(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ia(t.unaryFilter.field);return co.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ia(t.unaryFilter.field);return co.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Ia(t.unaryFilter.field);return co.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Ia(t.unaryFilter.field);return co.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return fi()}}function _a(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Sa(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Na(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Aa(e)),e=Da(t.get(n),e);return Aa(e)}function Da(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Aa(t){return t+""}function Ca(t){var e=t.length;if(pi(e>=2),2===e)return pi(""===t.charAt(0)&&""===t.charAt(1)),Ni.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&fi(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:fi()}o=s+2}return new Ni(r)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ka=function(t,e){this.seconds=t,this.nanoseconds=e},Oa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Oa.store="owner",Oa.key="owner";var Ra=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ra.store="mutationQueues",Ra.keyPath="userId";var xa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};xa.store="mutations",xa.keyPath="batchId",xa.userMutationsIndex="userMutationsIndex",xa.userMutationsKeyPath=["userId","batchId"];var La=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Na(e)]},t.key=function(t,e,n){return[t,Na(e),n]},t}();La.store="documentMutations",La.PLACEHOLDER=new La;var Pa=function(t,e){this.path=t,this.readTime=e},Fa=function(t,e){this.path=t,this.version=e},Ma=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ma.store="remoteDocuments",Ma.readTimeIndex="readTimeIndex",Ma.readTimeIndexPath="readTime",Ma.collectionReadTimeIndex="collectionReadTimeIndex",Ma.collectionReadTimeIndexPath=["parentPath","readTime"];var Va=function(t){this.byteSize=t};Va.store="remoteDocumentGlobal",Va.key="remoteDocumentGlobalKey";var Ua=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ua.store="targets",Ua.keyPath="targetId",Ua.queryTargetsIndexName="queryTargetsIndex",Ua.queryTargetsKeyPath=["canonicalId","targetId"];var qa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};qa.store="targetDocuments",qa.keyPath=["targetId","path"],qa.documentTargetsIndex="documentTargetsIndex",qa.documentTargetsKeyPath=["path","targetId"];var Ba=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ba.key="targetGlobalKey",Ba.store="targetGlobal";var ja=function(t,e){this.collectionId=t,this.parent=e};ja.store="collectionParents",ja.keyPath=["collectionId","parent"];var Ka=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ka.store="clientMetadata",Ka.keyPath="clientId";var Ga=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Ga.store="bundles",Ga.keyPath="bundleId";var za=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};za.store="namedQueries",za.keyPath="name";var Ha=a(a([],a(a([],a(a([],a(a([],[Ra.store,xa.store,La.store,Ma.store,Ua.store,Oa.store,Ba.store,qa.store]),[Ka.store])),[Va.store])),[ja.store])),[Ga.store,za.store]),Qa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Wa=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),Ya=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Xa=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&fi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(r){return t.reject(r)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),$a=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Ya,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new tu(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=ou(e.target.error);n.ft.reject(new tu(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(o){throw new tu(n,o)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(ui("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new nu(e)},t}(),Ja=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(h())&&ci("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return ui("SimpleDb","Removing database:",t),ru(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=h(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return r(this,void 0,void 0,(function(){var e,n=this;return i(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(ui("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new tu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new oi(ii.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new tu(t,n))},i.onupgradeneeded=function(t){ui("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){ui("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s,a,u,c;return i(this,(function(h){switch(h.label){case 0:r="readonly"===e,s=0,a=function(){var e,a,c,h,l;return i(this,(function(i){switch(i.label){case 0:++s,i.label=1;case 1:return i.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=i.sent(),e=$a.open(u.db,t,r?"readonly":"readwrite",n),a=o(e).catch((function(t){return e.abort(t),Xa.reject(t)})).toPromise(),c={},a.catch((function(){})),[4,e.dt];case 3:return[2,(c.value=(i.sent(),a),c)];case 4:return h=i.sent(),l="FirebaseError"!==h.name&&s<3,ui("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),u.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},u=this,h.label=1;case 1:return[5,a()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Za=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return ru(this.Pt.delete())},t}(),tu=function(t){function n(e,n){var r=this;return(r=t.call(this,ii.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return e(n,t),n}(oi);function eu(t){return"IndexedDbTransactionError"===t.name}var nu=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(ui("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(ui("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ru(n)},t.prototype.add=function(t){return ui("SimpleDb","ADD",this.store.name,t,t),ru(this.store.add(t))},t.prototype.get=function(t){var e=this;return ru(this.store.get(t)).next((function(n){return void 0===n&&(n=null),ui("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return ui("SimpleDb","DELETE",this.store.name,t),ru(this.store.delete(t))},t.prototype.count=function(){return ui("SimpleDb","COUNT",this.store.name),ru(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Ft=function(t,e){ui("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new Xa((function(n,r){e.onerror=function(t){var e=ou(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new Xa((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Za(i),s=e(i.primaryKey,i.value,o);if(s instanceof Xa){var a=s.catch((function(t){return o.done(),Xa.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return Xa.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function ru(t){return new Xa((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=ou(t.target.error);n(e)}}))}var iu=!1;function ou(t){var e=Ja._t(h());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new oi("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return iu||(iu=!0,setTimeout((function(){throw r}),0)),r}}return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var su=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return e(n,t),n}(Wa);function au(t,e){var n=di(t);return Ja.It(n.Mt,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var uu=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&us(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&cs(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&cs(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Ii.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Fs())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&gi(this.mutations,t.mutations,(function(t,e){return ls(t,e)}))&&gi(this.baseMutations,t.baseMutations,(function(t,e){return ls(t,e)}))},t}(),cu=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){pi(e.mutations.length===r.length);for(var i=Ls,o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),hu=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Ii.min()),void 0===o&&(o=Ii.min()),void 0===s&&(s=ki.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),lu=function(t){this.Lt=t};function fu(t,e){if(e.document)return function(t,e,n){var r=ia(t,e.name),i=ta(e.updateTime),o=new eo({mapValue:{fields:e.fields}}),s=ro.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Bi.fromSegments(e.noDocument.path),r=mu(e.noDocument.readTime),i=ro.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Bi.fromSegments(e.unknownDocument.path);return r=mu(e.unknownDocument.version),ro.newUnknownDocument(o,r)}return fi()}function pu(t,e,n){var r,i,o=du(n),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){var a={name:ra(r=t.Lt,(i=e).key),fields:i.data.toProto().mapValue.fields,updateTime:$s(r,i.version.toTimestamp())},u=e.hasCommittedMutations;return new Ma(null,null,a,u,o,s)}if(e.isNoDocument()){var c=e.key.path.toArray(),h=vu(e.version);return u=e.hasCommittedMutations,new Ma(null,new Pa(c,h),null,u,o,s)}if(e.isUnknownDocument()){var l=e.key.path.toArray(),f=vu(e.version);return new Ma(new Fa(l,f),null,null,!0,o,s)}return fi()}function du(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function yu(t){var e=new wi(t[0],t[1]);return Ii.fromTimestamp(e)}function vu(t){var e=t.toTimestamp();return new ka(e.seconds,e.nanoseconds)}function mu(t){var e=new wi(t.seconds,t.nanoseconds);return Ii.fromTimestamp(e)}function gu(t,e){for(var n=(e.baseMutations||[]).map((function(e){return la(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return la(t.Lt,e)})),a=wi.fromMillis(e.localWriteTimeMs);return new uu(e.batchId,a,n,s)}function bu(t){var e,n,r=mu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?mu(t.lastLimboFreeSnapshotVersion):Ii.min();return void 0!==t.query.documents?(pi(1===(n=t.query).documents.length),e=Lo(Do(sa(n.documents[0])))):e=Lo(da(t.query)),new hu(e,t.targetId,0,t.lastListenSequenceNumber,r,i,ki.fromBase64String(t.resumeToken))}function wu(t,e){var n,r=vu(e.snapshotVersion),i=vu(e.lastLimboFreeSnapshotVersion);n=uo(e.target)?fa(t.Lt,e.target):pa(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Ua(e.targetId,so(e.target),r,o,e.sequenceNumber,i,n)}function Iu(t){var e=da({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Po(e,e.limit,"L"):e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Eu=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Tu(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:mu(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Tu(t).put({bundleId:(n=e).id,createTime:vu(ta(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return _u(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Iu(e.bundledQuery),readTime:mu(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return _u(t).put({name:(n=e).name,readTime:vu(ta(n.readTime)),bundledQuery:n.bundledQuery});var n},t}();function Tu(t){return au(t,Ga.store)}function _u(t){return au(t,za.store)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Su=function(){function t(){this.Bt=new Nu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Xa.resolve()},t.prototype.getCollectionParents=function(t,e){return Xa.resolve(this.Bt.getEntries(e))},t}(),Nu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new As(Ni.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new As(Ni.comparator)).toArray()},t}(),Du=function(){function t(){this.qt=new Nu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:Na(i)};return Au(t).put(o)}return Xa.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[bi(e),""],!1,!0);return Au(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Ca(o.parent))}return n}))},t}();function Au(t){return au(t,ja.store)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ku=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ou(t,e,n){var r=t.store(xa.store),i=t.store(La.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Ot({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){pi(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=La.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Xa.waitFor(o).next((function(){return c}))}function Ru(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw fi();e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ku.DEFAULT_COLLECTION_PERCENTILE=10,ku.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ku.DEFAULT=new ku(41943040,ku.DEFAULT_COLLECTION_PERCENTILE,ku.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ku.DISABLED=new ku(-1,0,0);var xu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return pi(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Pu(t).Ot({index:xa.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Fu(t),s=Pu(t);return s.add({}).next((function(a){pi("number"==typeof a);for(var u=new uu(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return ha(t.Lt,e)})),i=n.mutations.map((function(e){return ha(t.Lt,e)}));return new xa(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new As((function(t,e){return mi(t.canonicalString(),e.canonicalString())})),f=0,p=r;f<p.length;f++){var d=p[f],y=La.key(i.userId,d.key.path,a);l=l.add(d.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,La.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Qt[a]=u.keys()})),Xa.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Pu(t).get(e).next((function(t){return t?(pi(t.userId===n.userId),gu(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?Xa.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Pu(t).Ot({index:xa.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(pi(e.batchId>=r),o=gu(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Pu(t).Ot({index:xa.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Pu(t).Nt(xa.userMutationsIndex,n).next((function(t){return t.map((function(t){return gu(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=La.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Fu(t).Ot({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=Ca(u);if(a===n.userId&&e.path.isEqual(h))return Pu(t).get(c).next((function(t){if(!t)throw fi();pi(t.userId===n.userId),o.push(gu(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new As(mi),i=[];return e.forEach((function(e){var o=La.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Fu(t).Ot({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=Ca(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),Xa.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=La.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new As(mi);return Fu(t).Ot({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=Ca(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Pu(t).get(e).next((function(t){if(null===t)throw fi();pi(t.userId===n.userId),r.push(gu(n.R,t))})))})),Xa.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Ou(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),Xa.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return Xa.resolve();var r=IDBKeyRange.lowerBound(La.prefixForUser(e.userId)),i=[];return Fu(t).Ot({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Ca(t[1]);i.push(o)}else r.done()})).next((function(){pi(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return Lu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Mu(t).get(this.userId).next((function(t){return t||new Ra(e.userId,-1,"")}))},t}();function Lu(t,e,n){var r=La.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Fu(t).Ot({range:o,kt:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function Pu(t){return au(t,xa.store)}function Fu(t){return au(t,La.store)}function Mu(t){return au(t,Ra.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Uu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new Vu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return Ii.fromTimestamp(new wi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return qu(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return pi(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return qu(t).Ot((function(s,a){var u=bu(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return Xa.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return qu(t).Ot((function(t,n){var r=bu(n);e(r)}))},t.prototype.Xt=function(t){return Bu(t).get(Ba.key).next((function(t){return pi(null!==t),t}))},t.prototype.Zt=function(t,e){return Bu(t).put(Ba.key,e)},t.prototype.te=function(t,e){return qu(t).put(wu(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=so(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return qu(t).Ot({range:r,index:Ua.queryTargetsIndexName},(function(t,n,r){var o=bu(n);ao(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=ju(t);return e.forEach((function(e){var s=Na(e.path);i.push(o.put(new qa(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),Xa.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=ju(t);return Xa.forEach(e,(function(e){var o=Na(e.path);return Xa.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ju(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ju(t),i=Fs();return r.Ot({range:n,kt:!0},(function(t,e,n){var r=Ca(t[1]),o=new Bi(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=Na(e.path),r=IDBKeyRange.bound([n],[bi(n)],!1,!0),i=0;return ju(t).Ot({index:qa.documentTargetsIndex,kt:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return qu(t).get(e).next((function(t){return t?bu(t):null}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qu(t){return au(t,Ua.store)}function Bu(t){return au(t,Ba.store)}function ju(t){return au(t,qa.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ku(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){if(t.code!==ii.FAILED_PRECONDITION||t.message!==Qa)throw t;return ui("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=mi(n,i);return 0===s?mi(r,o):s}var zu=function(){function t(t){this.ne=t,this.buffer=new As(Gu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Gu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Hu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;ui("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return r(e,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return eu(e=n.sent())?(ui("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Ku(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),Qu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Xa.resolve(ri.o);var r=new zu(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(ui("LruGarbageCollector","Garbage collection skipped; disabled"),Xa.resolve(Cu)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(ui("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Cu):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(ui("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),ai()<=N.DEBUG&&ui("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),Xa.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),Wu=function(){function t(t,e){this.db=t,this.garbageCollector=new Qu(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return Yu(t,n)},t.prototype.removeReference=function(t,e,n){return Yu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Yu(t,e)},t.prototype._e=function(t,e){return r=e,i=!1,Mu(n=t).$t((function(t){return Lu(n,t,r).next((function(t){return t&&(i=!0),Xa.resolve(!t)}))})).next((function(){return i}));var n,r,i},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),ju(t).delete([0,Na(s.path)])}))}));i.push(u)}})).next((function(){return Xa.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Yu(t,e)},t.prototype.we=function(t,e){var n,r=ju(t),i=ri.o;return r.Ot({index:qa.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==ri.o&&e(new Bi(Ca(n)),i),i=a,n=s):i=ri.o})).next((function(){i!==ri.o&&e(new Bi(Ca(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Yu(t,e){return ju(t).put((n=e,r=t.currentSequenceNumber,new qa(0,Na(n.path),r)));var n,r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Ti(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.isEmpty=function(){return _i(this.inner)},t}(),$u=function(){function t(){this.changes=new Xu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Ii.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:ro.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Xa.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Ju=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return ec(t).put(nc(e),n)},t.prototype.removeEntry=function(t,e){var n=ec(t),r=nc(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return ec(t).get(nc(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return ec(t).get(nc(e)).next((function(t){return{document:n.ye(e,t),size:Ru(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=Os();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=Os(),i=new Ss(Bi.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Ru(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return Xa.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return ec(t).Ot({range:r},(function(t,e,r){for(var s=Bi.fromSegments(t);o&&Bi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Os(),o=e.path.length+1,s={};if(n.isEqual(Ii.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=du(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Ma.collectionReadTimeIndex}return ec(t).Ot(s,(function(t,n,s){if(t.length===o){var a=fu(r.R,n);e.path.isPrefixOf(a.key.path)?Uo(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new Zu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return tc(t).get(Va.key).next((function(t){return pi(!!t),t}))},t.prototype.me=function(t,e){return tc(t).put(Va.key,e)},t.prototype.ye=function(t,e){if(e){var n=fu(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Ii.min()))return n}return ro.newInvalidDocument(t)},t}(),Zu=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Xu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return e(n,t),n.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new As((function(t,e){return mi(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=pu(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Ru(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=pu(e.Ie.R,ro.newNoDocument(o,Ii.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),Xa.waitFor(n)},n.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},n.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},n}($u);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(t){return au(t,Va.store)}function ec(t){return au(t,Ma.store)}function nc(t){return t.path.toArray()}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rc=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;pi(n<r&&n>=0&&r<=11);var o=new $a("createOrUpgrade",e);n<1&&r>=1&&(t.createObjectStore(Oa.store),function(t){t.createObjectStore(Ra.store,{keyPath:Ra.keyPath}),t.createObjectStore(xa.store,{keyPath:xa.keyPath,autoIncrement:!0}).createIndex(xa.userMutationsIndex,xa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(La.store)}(t),ic(t),function(t){t.createObjectStore(Ma.store)}(t));var s=Xa.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(qa.store),t.deleteObjectStore(Ua.store),t.deleteObjectStore(Ba.store)}(t),ic(t)),s=s.next((function(){return function(t){var e=t.store(Ba.store),n=new Ba(0,0,Ii.min().toTimestamp(),0);return e.put(Ba.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(xa.store).Nt().next((function(n){t.deleteObjectStore(xa.store),t.createObjectStore(xa.store,{keyPath:xa.keyPath,autoIncrement:!0}).createIndex(xa.userMutationsIndex,xa.userMutationsKeyPath,{unique:!0});var r=e.store(xa.store),i=n.map((function(t){return r.put(t)}));return Xa.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(Ka.store,{keyPath:Ka.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Va.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Ma.store);e.createIndex(Ma.readTimeIndex,Ma.readTimeIndexPath,{unique:!1}),e.createIndex(Ma.collectionReadTimeIndex,Ma.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(Ga.store,{keyPath:Ga.keyPath})}(t),function(t){t.createObjectStore(za.store,{keyPath:za.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(Ma.store).Ot((function(t,n){e+=Ru(n)})).next((function(){var n=new Va(e);return t.store(Va.store).put(Va.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(Ra.store),r=t.store(xa.store);return n.Nt().next((function(n){return Xa.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(xa.userMutationsIndex,i).next((function(r){return Xa.forEach(r,(function(r){pi(r.userId===n.userId);var i=gu(e.R,r);return Ou(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(qa.store),n=t.store(Ma.store);return t.store(Ba.store).get(Ba.key).next((function(t){var r=[];return n.Ot((function(n,i){var o=new Ni(n),s=[0,Na(o)];r.push(e.get(s).next((function(n){return n?Xa.resolve():(r=o,e.put(new qa(0,Na(r),t.highestListenSequenceNumber)));var r})))})).next((function(){return Xa.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(ja.store,{keyPath:ja.keyPath});var n=e.store(ja.store),r=new Nu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Na(i)})}};return e.store(Ma.store).Ot({kt:!0},(function(t,e){var n=new Ni(t);return i(n.popLast())})).next((function(){return e.store(La.store).Ot({kt:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Ca(n));return i(r.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(Ua.store);return n.Ot((function(t,r){var i=bu(r),o=wu(e.R,i);return n.put(o)}))},t}();function ic(t){t.createObjectStore(qa.store,{keyPath:qa.keyPath}).createIndex(qa.documentTargetsIndex,qa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ua.store,{keyPath:Ua.keyPath}).createIndex(Ua.queryTargetsIndexName,Ua.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ba.store)}var oc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",sc=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new oi(ii.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");var l,f;this.referenceDelegate=new Wu(this,i),this.Le=n+"main",this.R=new lu(u),this.Be=new Ja(this.Le,11,new rc(this.R)),this.qe=new Uu(this.referenceDelegate,this.R),this.Ut=new Du,this.Ue=(l=this.R,f=this.Ut,new Ju(l,f)),this.Qe=new Eu,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&ci("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new oi(ii.FAILED_PRECONDITION,oc);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new ri(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return r(e,void 0,void 0,(function(){return i(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return r(e,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return r(e,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return uc(e).put(new Ka(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(eu(e))return ui("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return ui("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return ac(t).get(Oa.key).next((function(t){return Xa.resolve(e.tn(t))}))},t.prototype.en=function(t){return uc(t).delete(this.clientId)},t.prototype.nn=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o=this;return i(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=au(t,Ka.store);return e.Nt().next((function(t){var n=o.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return Xa.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=i.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)r=n[e],this.Ke.removeItem(this.on(r.clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?Xa.resolve(!0):ac(t).get(Oa.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new oi(ii.FAILED_PRECONDITION,oc);return!1}}return!(!e.networkEnabled||!e.inForeground)||uc(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&ui("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Oa.store,Ka.store],(function(e){var n=new su(e,ri.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return uc(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return xu.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;ui("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,Ha,(function(o){return i=new su(o,r.Ne?r.Ne.next():ri.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw ci("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new oi(ii.FAILED_PRECONDITION,Qa);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return ac(t).get(Oa.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new oi(ii.FAILED_PRECONDITION,oc)}))},t.prototype.Ze=function(t){var e=new Oa(this.clientId,this.allowTabSynchronization,Date.now());return ac(t).put(Oa.key,e)},t.yt=function(){return Ja.yt()},t.prototype.Xe=function(t){var e=this,n=ac(t);return n.get(Oa.key).next((function(t){return e.tn(t)?(ui("IndexedDbPersistence","Releasing primary lease."),n.delete(Oa.key)):Xa.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(ci("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("unload",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return ui("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(r){return ci("IndexedDbPersistence","Failed to get zombied client id.",r),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){ci("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function ac(t){return au(t,Oa.store)}function uc(t){return au(t,Ka.store)}function cc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var hc=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,Bi.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(t,e.path):Ro(e)?this.In(t,e,n):this.An(t,e,n);var r},t.prototype.Tn=function(t,e){return this.mn(t,new Bi(e)).next((function(t){var e=xs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=xs();return this.Ut.getCollectionParents(t,i).next((function(s){return Xa.forEach(s,(function(s){var a,u,c=(a=e,u=s.child(i),new So(u,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));return r.An(t,c,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=ro.newInvalidDocument(c),r=r.insert(c,h)),cs(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){Uo(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=Fs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof ds&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),lc=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Fs(),i=Fs(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),fc=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i,o=this;return 0===(i=e).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||n.isEqual(Ii.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(i){var s=o.Cn(e,i);return(Ao(e)||Co(e))&&o.Nn(e.limitType,s,r,n)?o.Dn(t,e):(ai()<=N.DEBUG&&ui("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Vo(e)),o.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new As(qo(t));return e.forEach((function(e,r){Uo(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return ai()<=N.DEBUG&&ui("QueryEngine","Using full collection scan to execute query:",Vo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Ii.min())},t}(),pc=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Ss(mi),this.kn=new Xu((function(t){return so(t)}),ao),this.On=Ii.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new hc(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Fn)}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dc(t,e,n,r){return new pc(t,e,n,r)}function yc(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s;return i(this,(function(i){switch(i.label){case 0:return n=di(t),r=n._n,o=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var i;return n._n.getAllMutationBatches(t).next((function(s){return i=s,r=n.persistence.getMutationQueue(e),o=new hc(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=Fs(),a=0,u=i;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var p=0,d=e;p<d.length;p++){var y=d[p];r.push(y.batchId);for(var v=0,m=y.mutations;v<m.length;v++){var g=m[v];s=s.add(g.key)}}return o.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return s=i.sent(),[2,(n._n=r,n.Mn=o,n.xn.Vn(n.Mn),s)]}}))}))}function vc(t,e){var n=di(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r,i,o,s,a,u,c,h=e.batch.keys(),l=n.$n.newChangeBuffer({trackRemovals:!0});return(r=n,i=t,o=e,s=l,a=o.batch,u=a.keys(),c=Xa.resolve(),u.forEach((function(t){c=c.next((function(){return s.getEntry(i,t)})).next((function(e){var n=o.docVersions.get(t);pi(null!==n),e.version.compareTo(n)<0&&(a.applyToRemoteDocument(e,o),e.isValidDocument()&&s.addEntry(e,o.commitVersion))}))})),c.next((function(){return r._n.removeMutationBatch(i,a)}))).next((function(){return l.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,h)}))}))}function mc(t){var e=di(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function gc(t,e){var n=di(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach((function(e,o){var a,u,c,h=i.get(o);if(h){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var l=e.resumeToken;if(l.approximateByteSize()>0){var f=h.withResumeToken(l,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,f),a=h,c=e,pi((u=f).resumeToken.approximateByteSize()>0),(0===a.resumeToken.approximateByteSize()||u.snapshotVersion.toMicroseconds()-a.snapshotVersion.toMicroseconds()>=3e8||c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size>0)&&s.push(n.qe.updateTargetData(t,f))}}}));var a=Os();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(function(t,e,n,r,i){var o=Fs();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Os();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Ii.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):ui("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(Ii.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return Xa.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.Fn=i,t}))}function bc(t,e){var n=di(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function wc(t,e){var n=di(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,Xa.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new hu(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t}))}function Ic(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a;return i(this,(function(i){switch(i.label){case 0:r=di(t),o=r.Fn.get(e),s=n?"readwrite":"readwrite-primary",i.label=1;case 1:return i.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",s,(function(t){return r.persistence.referenceDelegate.removeTarget(t,o)}))];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:if(!eu(a=i.sent()))throw a;return ui("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(o.target),[2]}}))}))}function Ec(t,e,n){var r=di(t),i=Ii.min(),o=Fs();return r.persistence.runTransaction("Execute query","readonly",(function(t){return(s=r,a=t,u=Lo(e),c=di(s),h=c.kn.get(u),void 0!==h?Xa.resolve(c.Fn.get(h)):c.qe.getTargetData(a,u)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Ii.min(),n?o:Fs())})).next((function(t){return{documents:t,Bn:o}}));var s,a,u,c,h}))}function Tc(t,e){var n=di(t),r=di(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function _c(t){var e=di(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return n=e.$n,r=t,i=e.On,o=di(n),s=Os(),a=du(i),u=ec(r),c=IDBKeyRange.lowerBound(a,!0),u.Ot({index:Ma.readTimeIndex,range:c},(function(t,e){var n=fu(o.R,e);s=s.insert(n.key,n),a=e.readTime})).next((function(){return{wn:s,readTime:yu(a)}}));var n,r,i,o,s,a,u,c})).then((function(t){var n=t.wn,r=t.readTime;return e.On=r,n}))}function Sc(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){return[2,(e=di(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return e=ec(t),n=Ii.min(),e.Ot({index:Ma.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=yu(e.readTime)),r.done()})).next((function(){return n}));var e,n})).then((function(t){e.On=t}))]}))}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nc=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return Xa.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:ta(n.createTime)}),Xa.resolve()},t.prototype.getNamedQuery=function(t,e){return Xa.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:(n=e).name,query:Iu(n.bundledQuery),readTime:ta(n.readTime)}),Xa.resolve();var n},t}(),Dc=function(){function t(){this.Wn=new As(Ac.Gn),this.zn=new As(Ac.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Ac(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new Ac(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new Bi(new Ni([])),r=new Ac(n,t),i=new Ac(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Bi(new Ni([])),n=new Ac(e,t),r=new Ac(e,t+1),i=Fs();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Ac(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Ac=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Bi.comparator(t.key,e.key)||mi(t.ns,e.ns)},t.Hn=function(t,e){return mi(t.ns,e.ns)||Bi.comparator(t.key,e.key)},t}(),Cc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new As(Ac.Gn)}return t.prototype.checkEmpty=function(t){return Xa.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new uu(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Ac(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return Xa.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Xa.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return Xa.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Xa.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return Xa.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Ac(e,0),i=new Ac(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),Xa.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new As(mi);return e.forEach((function(t){var e=new Ac(t,0),i=new Ac(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),Xa.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Bi.isDocumentKey(i)||(i=i.child(""));var o=new Ac(new Bi(i),0),s=new As(mi);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),Xa.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;pi(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return Xa.forEach(e.mutations,(function(i){var o=new Ac(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Ac(e,0),r=this.rs.firstAfterOrEqual(n);return Xa.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,Xa.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),kc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Ss(Bi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Xa.resolve(n?n.document.clone():ro.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Os();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():ro.newInvalidDocument(t))})),Xa.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Os(),i=new Bi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||Uo(e,c)&&(r=r.insert(c.key,c.clone()))}return Xa.resolve(r)},t.prototype.fs=function(t,e){return Xa.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new Oc(this)},t.prototype.getSize=function(t){return Xa.resolve(this.size)},t}(),Oc=function(t){function n(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return e(n,t),n.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),Xa.waitFor(n)},n.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},n.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},n}($u),Rc=function(){function t(t){this.persistence=t,this.ds=new Xu((function(t){return so(t)}),ao),this.lastRemoteSnapshotVersion=Ii.min(),this.highestTargetId=0,this.ws=0,this._s=new Dc,this.targetCount=0,this.ys=Vu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),Xa.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Xa.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Xa.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Xa.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Xa.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Vu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Xa.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),Xa.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Xa.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),Xa.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return Xa.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return Xa.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Xa.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),Xa.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Xa.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return Xa.resolve(n)},t.prototype.containsKey=function(t,e){return Xa.resolve(this._s.containsKey(e))},t}(),xc=function(){function t(t,e){var n,r=this;this.gs={},this.Ne=new ri(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Rc(this),this.Ut=new Su,this.Ue=(n=this.Ut,new kc(n,(function(t){return r.referenceDelegate.ps(t)}))),this.R=new lu(e),this.Qe=new Nc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Cc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;ui("MemoryPersistence","Starting transaction:",t);var i=new Lc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return Xa.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),Lc=function(t){function n(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return e(n,t),n}(Wa),Pc=function(){function t(t){this.persistence=t,this.As=new Dc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw fi()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Xa.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Xa.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Xa.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Xa.forEach(this.vs,(function(r){var i=Bi.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return Xa.or([function(){return Xa.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Fc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mc(t,e){return"firestore_clients_"+t+"_"+e}function Vc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Uc(t,e){return"firestore_targets_"+t+"_"+e}Fc.UNAUTHENTICATED=new Fc(null),Fc.GOOGLE_CREDENTIALS=new Fc("google-credentials-uid"),Fc.FIRST_PARTY=new Fc("first-party-uid");var qc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new oi(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(ci("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Bc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new oi(i.error.code,i.error.message)),o?new t(e,i.state,r):(ci("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),jc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Vs(),s=0;i&&s<r.activeTargetIds.length;++s)i=qi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(ci("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Kc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(ci("SharedClientState","Failed to parse online state: "+e),null)},t}(),Gc=function(){function t(){this.activeTargetIds=Vs()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),zc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Ss(mi),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=Mc(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.ks=this.ks.insert(this.Ns,new Gc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,s,a,u,c,h,l,f=this;return i(this,(function(i){switch(i.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(o=this.getItem(Mc(this.persistenceKey,r)))&&(s=jc.Vs(r,o))&&(this.ks=this.ks.insert(s.clientId,s));for(this.Ks(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,h=this.Os;c<h.length;c++)l=h[c],this.Fs(l);return this.Os=[],this.window.addEventListener("unload",(function(){return f.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Uc(this.persistenceKey,t));if(n){var r=Bc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Uc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return ui("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){ui("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){ui("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(ui("SharedClientState","EVENT",n.key,n.newValue),n.key===this.$s)return void ci("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return r(e,void 0,void 0,(function(){var t,e,r,o,s,a;return i(this,(function(i){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(o=this.ri(n.key,n.newValue)))return[2,this.oi(o)]}else if(n.key===this.Us){if(null!==n.newValue&&(s=this.js(n.newValue)))return[2,this.Ws(s)]}else if(n.key===this.Ms)(a=function(t){var e=ri.o;if(null!=t)try{var n=JSON.parse(t);pi("number"==typeof n),e=n}catch(r){ci("SharedClientState","Failed to read sequence number from WebStorage",r)}return e}(n.newValue))!==ri.o&&this.sequenceNumberHandler(a);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new qc(this.currentUser,t,e,n),i=Vc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Vc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=Uc(this.persistenceKey,t),i=new Bc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return jc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return qc.Vs(new Fc(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Bc.Vs(r,e)},t.prototype.js=function(t){return Kc.Vs(t)},t.prototype.ii=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(ui("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.ks=r}))},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Vs();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),Hc=function(){function t(){this.li=new Gc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Gc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Qc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Wc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){ui("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){ui("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Yc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Xc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),$c=function(t){function n(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return e(n,t),n.prototype.ki=function(t,e,n,r){return new Promise((function(i,o){var s=new ni;s.listenOnce($r.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case Xr.NO_ERROR:var e=s.getResponseJson();ui("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Xr.TIMEOUT:ui("Connection",'RPC "'+t+'" timed out'),o(new oi(ii.DEADLINE_EXCEEDED,"Request time out"));break;case Xr.HTTP_ERROR:var n=s.getStatus();if(ui("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=(u=r.status,c=u.toLowerCase().replace(/_/g,"-"),Object.values(ii).indexOf(c)>=0?c:ii.UNKNOWN);o(new oi(a,r.message))}else o(new oi(ii.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new oi(ii.UNAVAILABLE,"Connection failed."));break;default:fi()}}finally{ui("Connection",'RPC "'+t+'" completed.')}var u,c}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},n.prototype.$i=function(t,e){var n,r,i=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=new zr,s=He(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(a.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())||"object"==typeof navigator&&"ReactNative"===navigator.product||h().indexOf("Electron/")>=0||((r=h()).indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0)||h().indexOf("MSAppHost/")>=0||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(a.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");ui("Connection","Creating WebChannel: "+u,a);var c=o.createWebChannel(u,a),l=!1,f=!1,p=new Xc({Ei:function(t){f?ui("Connection","Not sending because WebChannel is closed:",t):(l||(ui("Connection","Opening WebChannel transport."),c.open(),l=!0),ui("Connection","WebChannel sending:",t),c.send(t))},Ti:function(){return c.close()}}),d=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(e){setTimeout((function(){throw e}),0)}}))};return d(c,ei.EventType.OPEN,(function(){f||ui("Connection","WebChannel transport opened.")})),d(c,ei.EventType.CLOSE,(function(){f||(f=!0,ui("Connection","WebChannel transport closed"),p.Vi())})),d(c,ei.EventType.ERROR,(function(t){f||(f=!0,hi("Connection","WebChannel transport errored:",t),p.Vi(new oi(ii.UNAVAILABLE,"The operation could not be completed")))})),d(c,ei.EventType.MESSAGE,(function(t){var e;if(!f){var n=t.data[0];pi(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){ui("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=gs[t];if(void 0!==e)return _s(e)}(o),a=i.message;void 0===s&&(s=ii.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),f=!0,p.Vi(new oi(s,a)),c.close()}else ui("Connection","WebChannel received:",n),p.Si(n)}})),d(s,Jr.STAT_EVENT,(function(t){t.stat===Zr?ui("Connection","Detected buffering proxy"):t.stat===ti&&ui("Connection","Detected no buffering proxy")})),setTimeout((function(){p.Pi()}),0),p},n}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);ui("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then((function(t){return ui("RestConnection","Received: ",t),t}),(function(e){throw hi("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.4.2",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=Yc[t];return this.Di+"/v1/"+e+":"+n},t}());
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jc(){return"undefined"!=typeof window?window:null}function Zc(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function th(t){return new Xs(t,!0)}var eh=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&ui("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Qi=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),nh=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new eh(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===ii.RESOURCE_EXHAUSTED?(ci(e.toString()),ci("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===ii.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new oi(ii.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return r(t,void 0,void 0,(function(){return i(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return ui("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(ui("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),rh=function(t){function n(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return e(n,t),n.prototype.wr=function(t){return this.Hi.$i("Listen",t)},n.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n,r;if("targetChange"in e){e.targetChange;var i="NO_CHANGE"===(r=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:fi(),o=e.targetChange.targetIds||[],s=function(t,e){return t.I?(pi(void 0===e||"string"==typeof e),ki.fromBase64String(e||"")):(pi(void 0===e||e instanceof Uint8Array),ki.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),a=(u=e.targetChange.cause)&&function(t){var e=void 0===t.code?ii.UNKNOWN:_s(t.code);return new oi(e,t.message||"")}(u);n=new Ks(i,o,s,a||null)}else if("documentChange"in e){e.documentChange,(i=e.documentChange).document,i.document.name,i.document.updateTime,o=ia(t,i.document.name),s=ta(i.document.updateTime);var u=new eo({mapValue:{fields:i.document.fields}}),c=(a=ro.newFoundDocument(o,s,u),i.targetIds||[]),h=i.removedTargetIds||[];n=new Bs(c,h,a.key,a)}else if("documentDelete"in e)e.documentDelete,(i=e.documentDelete).document,o=ia(t,i.document),s=i.readTime?ta(i.readTime):Ii.min(),u=ro.newNoDocument(o,s),a=i.removedTargetIds||[],n=new Bs([],a,u.key,u);else if("documentRemove"in e)e.documentRemove,(i=e.documentRemove).document,o=ia(t,i.document),s=i.removedTargetIds||[],n=new Bs([],s,o,null);else{if(!("filter"in e))return fi();e.filter;var l=e.filter;l.targetId,i=l.count||0,o=new Es(i),s=l.targetId,n=new js(s,o)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Ii.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Ii.min():e.readTime?ta(e.readTime):Ii.min()}(t);return this.listener._r(e,n)},n.prototype.mr=function(t){var e,n,r,i,o={};o.database=aa(this.R),o.addTarget=(e=this.R,i=(n=t).target,(r=uo(i)?{documents:fa(e,i)}:{query:pa(e,i)}).targetId=n.targetId,n.resumeToken.approximateByteSize()>0?r.resumeToken=Js(e,n.resumeToken):n.snapshotVersion.compareTo(Ii.min())>0&&(r.readTime=$s(e,n.snapshotVersion.toTimestamp())),r);var s=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return fi()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);s&&(o.labels=s),this.cr(o)},n.prototype.yr=function(t){var e={};e.database=aa(this.R),e.removeTarget=t,this.cr(e)},n}(nh),ih=function(t){function n(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return e(n,t),Object.defineProperty(n.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},n.prototype.ar=function(){this.gr&&this.Er([])},n.prototype.wr=function(t){return this.Hi.$i("Write",t)},n.prototype.onMessage=function(t){if(pi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=(r=t.writeResults,i=t.commitTime,r&&r.length>0?(pi(void 0!==i),r.map((function(t){return n=i,(r=(e=t).updateTime?ta(e.updateTime):ta(n)).isEqual(Ii.min())&&(r=ta(n)),new is(r,e.transformResults||[]);var e,n,r}))):[]),n=ta(t.commitTime);return this.listener.Tr(n,e)}var r,i;return pi(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},n.prototype.Ar=function(){var t={};t.database=aa(this.R),this.cr(t)},n.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return ha(e.R,t)}))};this.cr(n)},n}(nh),oh=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return e(n,t),n.prototype.br=function(){if(this.Rr)throw new oi(ii.FAILED_PRECONDITION,"The client has already been terminated.")},n.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===ii.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new oi(ii.UNKNOWN,t.toString())}))},n.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Oi(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===ii.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new oi(ii.UNKNOWN,t.toString())}))},n.prototype.terminate=function(){this.Rr=!0},n}((function(){})),sh=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(ci(e),this.Vr=!1):ui("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),ah=function(t,e,n,o,s){var a=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=s,this.Lr.di((function(t){n.enqueueAndForget((function(){return r(a,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return vh(this)?(ui("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return(e=di(t)).$r.add(4),[4,ch(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,uh(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new sh(n,o)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uh(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:if(!vh(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function ch(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function hh(t,e){var n=di(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),yh(n)?dh(n):Oh(n).er()&&fh(n,e))}function lh(t,e){var n=di(t),r=Oh(n);n.Or.delete(e),r.er()&&ph(n,e),0===n.Or.size&&(r.er()?r.ir():vh(n)&&n.Br.set("Unknown"))}function fh(t,e){t.qr.U(e.targetId),Oh(t).mr(e)}function ph(t,e){t.qr.U(e),Oh(t).yr(e)}function dh(t){t.qr=new zs({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),Oh(t).start(),t.Br.Sr()}function yh(t){return vh(t)&&!Oh(t).tr()&&t.Or.size>0}function vh(t){return 0===di(t).$r.size}function mh(t){t.qr=void 0}function gh(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.Or.forEach((function(e,n){fh(t,e)})),[2]}))}))}function bh(t,e){return r(this,void 0,void 0,(function(){return i(this,(function(n){return mh(t),yh(t)?(t.Br.Nr(e),dh(t)):t.Br.set("Unknown"),[2]}))}))}function wh(t,e,n){return r(this,void 0,void 0,(function(){var o,s,a;return i(this,(function(u){switch(u.label){case 0:if(t.Br.set("Online"),!(e instanceof Ks&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s;return i(this,(function(i){switch(i.label){case 0:n=e.cause,r=0,o=e.targetIds,i.label=1;case 1:return r<o.length?(s=o[r],t.Or.has(s)?[4,t.remoteSyncer.rejectListen(s,n)]:[3,3]):[3,5];case 2:i.sent(),t.Or.delete(s),t.qr.removeTarget(s),i.label=3;case 3:i.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return u.sent(),[3,5];case 3:return o=u.sent(),ui("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),[4,Ih(t,o)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Bs?t.qr.X(e):e instanceof js?t.qr.rt(e):t.qr.et(e),n.isEqual(Ii.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,mc(t.localStore)];case 8:return s=u.sent(),n.compareTo(s)>=0?[4,(c=t,h=n,l=c.qr.ut(h),l.targetChanges.forEach((function(t,e){if(t.resumeToken.approximateByteSize()>0){var n=c.Or.get(e);n&&c.Or.set(e,n.withResumeToken(t.resumeToken,h))}})),l.targetMismatches.forEach((function(t){var e=c.Or.get(t);if(e){c.Or.set(t,e.withResumeToken(ki.EMPTY_BYTE_STRING,e.snapshotVersion)),ph(c,t);var n=new hu(e.target,t,1,e.sequenceNumber);fh(c,n)}})),c.remoteSyncer.applyRemoteEvent(l))]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return ui("RemoteStore","Failed to raise snapshot:",a=u.sent()),[4,Ih(t,a)];case 12:return u.sent(),[3,13];case 13:return[2]}var c,h,l}))}))}function Ih(t,e,n){return r(this,void 0,void 0,(function(){var o=this;return i(this,(function(s){switch(s.label){case 0:if(!eu(e))throw e;return t.$r.add(1),[4,ch(t)];case 1:return s.sent(),t.Br.set("Offline"),n||(n=function(){return mc(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return r(o,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return ui("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,uh(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Eh(t,e){return e().catch((function(n){return Ih(t,n,e)}))}function Th(t){return r(this,void 0,void 0,(function(){var e,n,r,o,s;return i(this,(function(i){switch(i.label){case 0:e=di(t),n=Rh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,i.label=1;case 1:if(!(vh(a=e)&&a.kr.length<10))return[3,7];i.label=2;case 2:return i.trys.push([2,4,,6]),[4,bc(e.localStore,r)];case 3:return null===(o=i.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=o.batchId,function(t,e){t.kr.push(e);var n=Rh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,o),[3,6]);case 4:return s=i.sent(),[4,Ih(e,s)];case 5:return i.sent(),[3,6];case 6:return[3,1];case 7:return _h(e)&&Sh(e),[2]}var a}))}))}function _h(t){return vh(t)&&!Rh(t).tr()&&t.kr.length>0}function Sh(t){Rh(t).start()}function Nh(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return Rh(t).Ar(),[2]}))}))}function Dh(t){return r(this,void 0,void 0,(function(){var e,n,r,o;return i(this,(function(i){for(e=Rh(t),n=0,r=t.kr;n<r.length;n++)o=r[n],e.Er(o.mutations);return[2]}))}))}function Ah(t,e,n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return r=t.kr.shift(),o=cu.from(r,e,n),[4,Eh(t,(function(){return t.remoteSyncer.applySuccessfulWrite(o)}))];case 1:return i.sent(),[4,Th(t)];case 2:return i.sent(),[2]}}))}))}function Ch(t,e){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e&&Rh(t).pr?[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return Ts(r=e.code)&&r!==ii.ABORTED?(n=t.kr.shift(),Rh(t).sr(),[4,Eh(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Th(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return _h(t)&&Sh(t),[2]}}))}))}function kh(t,e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=di(t),e?(n.$r.delete(2),[4,uh(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,ch(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Oh(t){var e,n,o,s,a=this;return t.Ur||(t.Ur=(e=t.datastore,n=t.asyncQueue,o={Ii:gh.bind(null,t),Ri:bh.bind(null,t),_r:wh.bind(null,t)},(s=di(e)).br(),new rh(n,s.Hi,s.credentials,s.R,o)),t.Mr.push((function(e){return r(a,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e?(t.Ur.sr(),yh(t)?dh(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:n.sent(),mh(t),n.label=3;case 3:return[2]}}))}))}))),t.Ur}function Rh(t){var e,n,o,s,a=this;return t.Qr||(t.Qr=(e=t.datastore,n=t.asyncQueue,o={Ii:Nh.bind(null,t),Ri:Ch.bind(null,t),Ir:Dh.bind(null,t),Tr:Ah.bind(null,t)},(s=di(e)).br(),new ih(n,s.Hi,s.credentials,s.R,o)),t.Mr.push((function(e){return r(a,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e?(t.Qr.sr(),[4,Th(t)]):[3,2];case 1:return n.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:n.sent(),t.kr.length>0&&(ui("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),n.label=4;case 4:return[2]}}))}))}))),t.Qr}var xh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ya,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new oi(ii.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Lh(t,e){if(ci("AsyncQueue",e+": "+t),eu(t))return new oi(ii.UNAVAILABLE,e+": "+t);throw t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ph=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Bi.comparator(e.key,n.key)}:function(t,e){return Bi.comparator(t.key,e.key)},this.keyedMap=xs(),this.sortedSet=new Ss(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Fh=function(){function t(){this.Kr=new Ss(Bi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):fi():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),Mh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,Ph.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Fo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Vh=function(){this.Wr=void 0,this.listeners=[]},Uh=function(){this.queries=new Xu((function(t){return Mo(t)}),Fo),this.onlineState="Unknown",this.Gr=new Set};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qh(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c;return i(this,(function(i){switch(i.label){case 0:if(n=di(t),r=e.query,o=!1,(s=n.queries.get(r))||(o=!0,s=new Vh),!o)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),a=s,[4,n.onListen(r)];case 2:return a.Wr=i.sent(),[3,4];case 3:return u=i.sent(),c=Lh(u,"Initialization of query '"+Vo(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,s),s.listeners.push(e),e.zr(n.onlineState),s.Wr&&e.Hr(s.Wr)&&Gh(n),[2]}}))}))}function Bh(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a;return i(this,(function(i){return n=di(t),r=e.query,o=!1,(s=n.queries.get(r))&&(a=s.listeners.indexOf(e))>=0&&(s.listeners.splice(a,1),o=0===s.listeners.length),o?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function jh(t,e){for(var n=di(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&Gh(n)}function Kh(t,e,n){var r=di(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Gh(t){t.Gr.forEach((function(t){t.next()}))}var zh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Mh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Mh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),Hh=function(t){this.key=t},Qh=function(t){this.key=t},Wh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Fs(),this.mutatedKeys=Fs(),this.lo=qo(t),this.fo=new Ph(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Fh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Ao(this.query)&&i.size===this.query.limit?i.last():null,c=Co(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=Uo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),p=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data.isEqual(l.data)?f!==p&&(r.track({type:3,doc:l}),d=!0):n.yo(h,l)||(r.track({type:2,doc:l}),d=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),d=!0):h&&!l&&(r.track({type:1,doc:h}),d=!0,(u||c)&&(a=!0)),d&&(l?(s=s.add(l),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Ao(this.query)||Co(this.query))for(;s.size>this.query.limit;){var h=Ao(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return n=t.type,i=e.type,(o=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fi()}})(n)-o(i)||r.lo(t.doc,e.doc);var n,i,o})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Mh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Fh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Fs(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new Qh(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new Hh(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Fs();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Mh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Yh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Xh=function(t){this.key=t,this.bo=!1},$h=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Xu((function(t){return Mo(t)}),Fo),this.Vo=new Map,this.So=new Set,this.Do=new Ss(Bi.comparator),this.Co=new Map,this.No=new Dc,this.xo={},this.Fo=new Map,this.ko=Vu.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jh(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u;return i(this,(function(i){switch(i.label){case 0:return n=Dl(t),(s=n.Po.get(e))?(r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),o=s.view.Ro(),[3,4]):[3,1];case 1:return[4,wc(n.localStore,Lo(e))];case 2:return a=i.sent(),u=n.sharedClientState.addLocalQueryTarget(a.targetId),r=a.targetId,[4,Zh(n,e,r,"current"===u)];case 3:o=i.sent(),n.isPrimaryClient&&hh(n.remoteStore,a),i.label=4;case 4:return[2,o]}}))}))}function Zh(t,e,n,o){return r(this,void 0,void 0,(function(){var s,a,u,c,h,l;return i(this,(function(f){switch(f.label){case 0:return t.$o=function(e,n,o){return function(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s,a;return i(this,(function(i){switch(i.label){case 0:return(r=e.view._o(n)).Nn?[4,Ec(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view._o(n,r)}))]:[3,2];case 1:r=i.sent(),i.label=2;case 2:return s=o&&o.targetChanges.get(e.targetId),a=e.view.applyChanges(r,t.isPrimaryClient,s),[2,(fl(t,e.targetId,a.To),a.snapshot)]}}))}))}(t,e,n,o)},[4,Ec(t.localStore,e,!0)];case 1:return s=f.sent(),a=new Wh(e,s.Bn),u=a._o(s.documents),c=qs.createSynthesizedTargetChangeForCurrentChange(n,o&&"Offline"!==t.onlineState),h=a.applyChanges(u,t.isPrimaryClient,c),fl(t,n,h.To),l=new Yh(e,n,a),[2,(t.Po.set(e,l),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),h.snapshot)]}}))}))}function tl(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return n=di(t),r=n.Po.get(e),(o=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,o.filter((function(t){return!Fo(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Ic(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),lh(n.remoteStore,r.targetId),hl(n,r.targetId)})).catch(Ku)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return hl(n,r.targetId),[4,Ic(n.localStore,r.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))}function el(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a;return i(this,(function(i){switch(i.label){case 0:r=Al(t),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,(u=r.localStore,c=e,l=di(u),f=wi.now(),p=c.reduce((function(t,e){return t.add(e.key)}),Fs()),l.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return l.Mn.pn(t,p).next((function(e){h=e;for(var n=[],r=0,i=c;r<i.length;r++){var o=i[r],s=hs(o,h.get(o.key));null!=s&&n.push(new ds(o.key,s,no(s.toProto().mapValue),os.exists(!0)))}return l._n.addMutationBatch(t,f,n,c)}))})).then((function(t){return t.applyToLocalDocumentSet(h),{batchId:t.batchId,changes:h}})))];case 2:return o=i.sent(),r.sharedClientState.addPendingMutation(o.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Ss(mi)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,o.batchId,n),[4,yl(r,o.changes)];case 3:return i.sent(),[4,Th(r.remoteStore)];case 4:return i.sent(),[3,6];case 5:return s=i.sent(),a=Lh(s,"Failed to persist write"),n.reject(a),[3,6];case 6:return[2]}var u,c,h,l,f,p}))}))}function nl(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:n=di(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,gc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(pi(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?pi(r.bo):t.removedDocuments.size>0&&(pi(r.bo),r.bo=!1))})),[4,yl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Ku(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function rl(t,e,n){var r=di(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=di(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&Gh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function il(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a,u,c;return i(this,(function(i){switch(i.label){case 0:return(r=di(t)).sharedClientState.updateQueryState(e,"rejected",n),o=r.Co.get(e),(s=o&&o.key)?(a=(a=new Ss(Bi.comparator)).insert(s,ro.newNoDocument(s,Ii.min())),u=Fs().add(s),c=new Us(Ii.min(),new Map,new As(mi),a,u),[4,nl(r,c)]):[3,2];case 1:return i.sent(),r.Do=r.Do.remove(s),r.Co.delete(e),dl(r),[3,4];case 2:return[4,Ic(r.localStore,e,!1).then((function(){return hl(r,e,n)})).catch(Ku)];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))}function ol(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:n=di(t),r=e.batch.batchId,i.label=1;case 1:return i.trys.push([1,4,,6]),[4,vc(n.localStore,e)];case 2:return o=i.sent(),cl(n,r,null),ul(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,yl(n,o)];case 3:return i.sent(),[3,6];case 4:return[4,Ku(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function sl(t,e,n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:r=di(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,(s=r.localStore,a=e,u=di(s),u.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var e;return u._n.lookupMutationBatch(t,a).next((function(n){return pi(null!==n),e=n.keys(),u._n.removeMutationBatch(t,n)})).next((function(){return u._n.performConsistencyCheck(t)})).next((function(){return u.Mn.pn(t,e)}))})))];case 2:return o=i.sent(),cl(r,e,n),ul(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,yl(r,o)];case 3:return i.sent(),[3,6];case 4:return[4,Ku(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}var s,a,u}))}))}function al(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a;return i(this,(function(i){switch(i.label){case 0:vh((n=di(t)).remoteStore)||ui("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,(u=n.localStore,c=di(u),c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return c._n.getHighestUnacknowledgedBatchId(t)})))];case 2:return-1===(r=i.sent())?[2,void e.resolve()]:((o=n.Fo.get(r)||[]).push(e),n.Fo.set(r,o),[3,4]);case 3:return s=i.sent(),a=Lh(s,"Initialization of waitForPendingWrites() operation failed"),e.reject(a),[3,4];case 4:return[2]}var u,c}))}))}function ul(t,e){(t.Fo.get(e)||[]).forEach((function(t){t.resolve()})),t.Fo.delete(e)}function cl(t,e,n){var r=di(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function hl(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||ll(t,e)}))}function ll(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(lh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),dl(t))}function fl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Hh?(t.No.addReference(o.key,e),pl(t,o)):o instanceof Qh?(ui("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||ll(t,o.key)):fi()}}function pl(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(ui("SyncEngine","New document in limbo: "+n),t.So.add(r),dl(t))}function dl(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Bi(Ni.fromString(e)),r=t.ko.next();t.Co.set(r,new Xh(n)),t.Do=t.Do.insert(n,r),hh(t.remoteStore,new hu(Lo(Do(n.path)),r,2,ri.o))}}function yl(t,e,n){return r(this,void 0,void 0,(function(){var o,s,a,u;return i(this,(function(c){switch(c.label){case 0:return o=di(t),s=[],a=[],u=[],o.Po.isEmpty()?[3,3]:(o.Po.forEach((function(t,r){u.push(o.$o(r,e,n).then((function(t){if(t){o.isPrimaryClient&&o.sharedClientState.updateQueryState(r.targetId,t.fromCache?"not-current":"current"),s.push(t);var e=lc.Pn(r.targetId,t);a.push(e)}})))})),[4,Promise.all(u)]);case 1:return c.sent(),o.vo._r(s),[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h,l;return i(this,(function(i){switch(i.label){case 0:n=di(t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Xa.forEach(e,(function(e){return Xa.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return Xa.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return i.sent(),[3,4];case 3:if(!eu(r=i.sent()))throw r;return ui("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(o=0,s=e;o<s.length;o++)a=s[o],u=a.targetId,a.fromCache||(c=n.Fn.get(u),h=c.snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),n.Fn=n.Fn.insert(u,l));return[2]}}))}))}(o.localStore,a)];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))}function vl(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return(n=di(t)).currentUser.isEqual(e)?[3,3]:(ui("SyncEngine","User change. New user:",e.toKey()),[4,yc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,(o=n).Fo.forEach((function(t){t.forEach((function(t){t.reject(new oi(ii.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),o.Fo.clear(),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,yl(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}var o}))}))}function ml(t,e){var n=di(t),r=n.Co.get(e);if(r&&r.bo)return Fs().add(r.key);var i=Fs(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function gl(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return[4,Ec((n=di(t)).localStore,e.query,!0)];case 1:return r=i.sent(),o=e.view.Ao(r),[2,(n.isPrimaryClient&&fl(n,e.targetId,o.To),o)]}}))}))}function bl(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){return[2,_c((e=di(t)).localStore).then((function(t){return yl(e,t)}))]}))}))}function wl(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s;return i(this,(function(i){switch(i.label){case 0:return[4,(a=(r=di(t)).localStore,u=e,c=di(a),h=di(c._n),c.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return h.jt(t,u).next((function(e){return e?c.Mn.pn(t,e):Xa.resolve(null)}))})))];case 1:return null===(s=i.sent())?[3,6]:"pending"!==n?[3,3]:[4,Th(r.remoteStore)];case 2:return i.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(cl(r,e,o||null),ul(r,e),function(t,e){di(di(t)._n).Gt(e)}(r.localStore,e)):fi(),i.label=4;case 4:return[4,yl(r,s)];case 5:return i.sent(),[3,7];case 6:ui("SyncEngine","Cannot apply mutation batch with id: "+e),i.label=7;case 7:return[2]}var a,u,c,h}))}))}function Il(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h;return i(this,(function(i){switch(i.label){case 0:return Dl(n=di(t)),Al(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,El(n,r.toArray())]);case 1:return o=i.sent(),n.Oo=!0,[4,kh(n.remoteStore,!0)];case 2:for(i.sent(),s=0,a=o;s<a.length;s++)u=a[s],hh(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(c=[],h=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then((function(){return hl(n,e),Ic(n.localStore,e,!0)})),lh(n.remoteStore,e)})),[4,h]);case 4:return i.sent(),[4,El(n,c)];case 5:return i.sent(),(l=di(n)).Co.forEach((function(t,e){lh(l.remoteStore,e)})),l.No.ts(),l.Co=new Map,l.Do=new Ss(Bi.comparator),n.Oo=!1,[4,kh(n.remoteStore,!1)];case 6:i.sent(),i.label=7;case 7:return[2]}var l}))}))}function El(t,e,n){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h,l,f,p,d,y,v;return i(this,(function(i){switch(i.label){case 0:n=di(t),r=[],o=[],s=0,a=e,i.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(h=n.Vo.get(u))&&0!==h.length?[4,wc(n.localStore,Lo(h[0]))]:[3,7]):[3,13];case 2:c=i.sent(),l=0,f=h,i.label=3;case 3:return l<f.length?(p=f[l],d=n.Po.get(p),[4,gl(n,d)]):[3,6];case 4:(y=i.sent()).snapshot&&o.push(y.snapshot),i.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,Tc(n.localStore,u)];case 8:return v=i.sent(),[4,wc(n.localStore,v)];case 9:return c=i.sent(),[4,Zh(n,Tl(v),u,!1)];case 10:i.sent(),i.label=11;case 11:r.push(c),i.label=12;case 12:return s++,[3,1];case 13:return[2,(n.vo._r(o),r)]}}))}))}function Tl(t){return No(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function _l(t){var e=di(t);return di(di(e.localStore).persistence).fn()}function Sl(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s,a;return i(this,(function(i){switch(i.label){case 0:return(r=di(t)).Oo?(ui("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!r.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,_c(r.localStore)];case 3:return s=i.sent(),a=Us.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,yl(r,s,a)];case 4:return i.sent(),[3,8];case 5:return[4,Ic(r.localStore,e,!0)];case 6:return i.sent(),hl(r,e,o),[3,8];case 7:fi(),i.label=8;case 8:return[2]}}))}))}function Nl(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a,u,c,h,l,f,p;return i(this,(function(d){switch(d.label){case 0:if(!(r=Dl(t)).Oo)return[3,10];o=0,s=e,d.label=1;case 1:return o<s.length?(a=s[o],r.Vo.has(a)?(ui("SyncEngine","Adding an already active target "+a),[3,5]):[4,Tc(r.localStore,a)]):[3,6];case 2:return u=d.sent(),[4,wc(r.localStore,u)];case 3:return c=d.sent(),[4,Zh(r,Tl(u),c.targetId,!1)];case 4:d.sent(),hh(r.remoteStore,c),d.label=5;case 5:return o++,[3,1];case 6:h=function(t){return i(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Ic(r.localStore,t,!1).then((function(){lh(r.remoteStore,t),hl(r,t)})).catch(Ku)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},l=0,f=n,d.label=7;case 7:return l<f.length?(p=f[l],[5,h(p)]):[3,10];case 8:d.sent(),d.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function Dl(t){var e=di(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=nl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ml.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=il.bind(null,e),e.vo._r=jh.bind(null,e.eventManager),e.vo.Mo=Kh.bind(null,e.eventManager),e}function Al(t){var e=di(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ol.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=sl.bind(null,e),e}var Cl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.R=th(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return dc(this.persistence,new fc,t.initialUser,this.R)},t.prototype.qo=function(t){return new xc(Pc.bs,this.R)},t.prototype.Bo=function(t){return new Hc},t.prototype.terminate=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),kl=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return e(n,t),n.prototype.initialize=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Sc(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,Al(this.Ko.syncEngine)];case 4:return n.sent(),[4,Th(this.Ko.remoteStore)];case 5:return n.sent(),[2]}}))}))},n.prototype.Qo=function(t){return dc(this.persistence,new fc,t.initialUser,this.R)},n.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new Hu(e,t.asyncQueue)},n.prototype.qo=function(t){var e=cc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ku.withCacheSize(this.cacheSizeBytes):ku.DEFAULT;return new sc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Jc(),Zc(),this.R,this.sharedClientState,!!this.forceOwnership)},n.prototype.Bo=function(t){return new Hc},n}(Cl),Ol=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return e(n,t),n.prototype.initialize=function(e){return r(this,void 0,void 0,(function(){var n,o=this;return i(this,(function(s){switch(s.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return s.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof zc?(this.sharedClientState.syncEngine={ui:wl.bind(null,n),ai:Sl.bind(null,n),hi:Nl.bind(null,n),fn:_l.bind(null,n),ci:bl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:s.sent(),s.label=3;case 3:return[4,this.persistence.He((function(t){return r(o,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,Il(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return s.sent(),[2]}}))}))},n.prototype.Bo=function(t){var e=Jc();if(!zc.yt(e))throw new oi(ii.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=cc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new zc(e,t.asyncQueue,n,t.clientId,t.initialUser)},n}(kl),Rl=function(){function t(){}return t.prototype.initialize=function(t,e){return r(this,void 0,void 0,(function(){var n=this;return i(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return rl(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=vl.bind(null,this.syncEngine),[4,kh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new Uh},t.prototype.createDatastore=function(t){var e,n,r=th(t.databaseInfo.databaseId),i=(e=t.databaseInfo,new $c(e));return n=t.credentials,new oh(n,i,r)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return rl(s.syncEngine,t,0)},o=Wc.yt()?new Wc:new Qc,new ah(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return n=this.localStore,r=this.remoteStore,i=this.eventManager,o=this.sharedClientState,s=t.initialUser,a=t.maxConcurrentLimboResolutions,u=e,c=new $h(n,r,i,o,s,a),u&&(c.Oo=!0),c;var n,r,i,o,s,a,u,c},t.prototype.terminate=function(){return function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=di(t),ui("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,ch(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),xl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),Ll=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return r(this,void 0,void 0,(function(){var e,n=this;return i(this,(function(o){switch(o.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new oi(ii.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u;return i(this,(function(i){switch(i.label){case 0:return n=di(t),r=aa(n.R)+"/documents",o={documents:e.map((function(t){return ra(n.R,t)}))},[4,n.Oi("BatchGetDocuments",r,o)];case 1:return s=i.sent(),a=new Map,s.forEach((function(t){var e,r,i=(e=n.R,"found"in(r=t)?function(t,e){pi(!!e.found),e.found.name,e.found.updateTime;var n=ia(t,e.found.name),r=ta(e.found.updateTime),i=new eo({mapValue:{fields:e.found.fields}});return ro.newFoundDocument(n,r,i)}(e,r):"missing"in r?function(t,e){pi(!!e.missing),pi(!!e.readTime);var n=ia(t,e.missing),r=ta(e.readTime);return ro.newNoDocument(n,r)}(e,r):fi());a.set(i.key.toString(),i)})),u=[],[2,(e.forEach((function(t){var e=a.get(t.toString());pi(!!e),u.push(e)})),u)]}}))}))}(this.datastore,t)];case 1:return[2,((e=o.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastWriteError=n}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new ws(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return r(this,void 0,void 0,(function(){var t,e=this;return i(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=Bi.fromPath(n);e.mutations.push(new Is(r,e.precondition(r)))})),[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return n=di(t),r=aa(n.R)+"/documents",o={writes:e.map((function(t){return ha(n.R,t)}))},[4,n.Ni("Commit",r,o)];case 1:return i.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw fi();e=Ii.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new oi(ii.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?os.updateTime(e):os.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Ii.min()))throw new oi(ii.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return os.updateTime(e)}return os.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),Pl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new eh(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return r(t,void 0,void 0,(function(){var t,e,n=this;return i(this,(function(r){return t=new Ll(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Vi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.deferred.reject(n),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ts(e)}return!1},t}(),Fl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Fc.UNAUTHENTICATED,this.clientId=vi.u(),this.credentialListener=function(){},this.receivedInitialUser=new Ya,this.credentials.setChangeListener((function(t){ui("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()}))}return t.prototype.getConfiguration=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}}))}))},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then((function(){return e.credentialListener(e.user)}))},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new oi(ii.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Ya;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return r(t,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Lh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ml(t,e){return r(this,void 0,void 0,(function(){var n,o,s=this;return i(this,(function(a){switch(a.label){case 0:return t.asyncQueue.verifyOperationInProgress(),ui("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=a.sent(),[4,e.initialize(n)];case 2:return a.sent(),o=n.initialUser,t.setCredentialChangeListener((function(n){o.isEqual(n)||(o=n,t.asyncQueue.enqueueRetryable((function(){return r(s,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,yc(e.localStore,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function Vl(t,e){return r(this,void 0,void 0,(function(){var n,o;return i(this,(function(s){switch(s.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Ul(t)];case 1:return n=s.sent(),ui("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return o=s.sent(),[4,e.initialize(n,o)];case 3:return s.sent(),t.setCredentialChangeListener((function(n){return t.asyncQueue.enqueueRetryable((function(){return function(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return(n=di(t)).asyncQueue.verifyOperationInProgress(),ui("RemoteStore","RemoteStore received new credentials"),r=vh(n),n.$r.add(3),[4,ch(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,uh(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,n)}))})),t.onlineComponents=e,[2]}}))}))}function Ul(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(ui("FirestoreClient","Using default OfflineComponentProvider"),[4,Ml(t,new Cl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function ql(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(ui("FirestoreClient","Using default OnlineComponentProvider"),[4,Vl(t,new Rl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function Bl(t){return Ul(t).then((function(t){return t.persistence}))}function jl(t){return Ul(t).then((function(t){return t.localStore}))}function Kl(t){return ql(t).then((function(t){return t.remoteStore}))}function Gl(t){return ql(t).then((function(t){return t.syncEngine}))}function zl(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,ql(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Jh.bind(null,e.syncEngine),n.onUnlisten=tl.bind(null,e.syncEngine),n)]}}))}))}function Hl(t,e,n){var o=this;void 0===n&&(n={});var s=new Ya;return t.asyncQueue.enqueueAndForget((function(){return r(o,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new xl({next:function(o){e.enqueueAndForget((function(){return Bh(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new oi(ii.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new oi(ii.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new zh(Do(n.path),o,{includeMetadataChanges:!0,so:!0});return qh(t,s)},[4,zl(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,s])]}}))}))})),s.promise}function Ql(t,e,n){var o=this;void 0===n&&(n={});var s=new Ya;return t.asyncQueue.enqueueAndForget((function(){return r(o,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new xl({next:function(n){e.enqueueAndForget((function(){return Bh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new oi(ii.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new zh(n,o,{includeMetadataChanges:!0,so:!0});return qh(t,s)},[4,zl(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,s])]}}))}))})),s.promise}var Wl=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},Yl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Xl=new Map,$l=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Jl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(Fc.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Zl=function(){function t(t){var e=this;this.oc=null,this.currentUser=Fc.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then((function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(ui("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(pi("string"==typeof n.accessToken),new $l(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},t.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return pi(null===t||"string"==typeof t),new Fc(t)},t}(),tf=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n,this.type="FirstParty",this.user=Fc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.lc&&(t["X-Goog-Iam-Authorization-Token"]=this.lc),t},enumerable:!1,configurable:!0}),t}(),ef=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n}return t.prototype.getToken=function(){return Promise.resolve(new tf(this.ac,this.hc,this.lc))},t.prototype.setChangeListener=function(t){t(Fc.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nf(t,e,n){if(!n)throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function rf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new oi(ii.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function of(t,e,n,r){if(!0===e&&!0===r)throw new oi(ii.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function sf(t){if(!Bi.isDocumentKey(t))throw new oi(ii.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function af(t){if(Bi.isDocumentKey(t))throw new oi(ii.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function uf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":fi()}function cf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new oi(ii.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=uf(t);throw new oi(ii.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function hf(t,e){if(e<=0)throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var lf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new oi(ii.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new oi(ii.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,of("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),ff=function(){function t(t,e){this._persistenceKey="(lite)",this._settings=new lf({}),this._settingsFrozen=!1,t instanceof Yl?(this._databaseId=t,this._credentials=new Jl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new oi(ii.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Yl(t.options.projectId)}(t),this._credentials=new Zl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new oi(ii.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new oi(ii.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Jl;switch(t.type){case"gapi":var e=t.client;return pi(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new ef(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new oi(ii.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return this,(t=Xl.get(this))&&(ui("ComponentProvider","Removing Datastore"),Xl.delete(this),t.terminate()),Promise.resolve();var t},t}(),pf=function(){function t(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new yf(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),df=function(){function t(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),yf=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n,Do(r))||this)._path=r,i.type="collection",i}return e(n,t),Object.defineProperty(n.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new pf(this.firestore,null,new Bi(t))},enumerable:!1,configurable:!0}),n.prototype.withConverter=function(t){return new n(this.firestore,t,this._path)},n}(df);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=w(t),nf("collection","path",e),t instanceof ff)return af(n=Ni.fromString.apply(Ni,a([e],r))),new yf(t,null,n);if(!(t instanceof pf||t instanceof yf))throw new oi(ii.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return af(n=Ni.fromString.apply(Ni,a([t.path],r)).child(Ni.fromString(e))),new yf(t.firestore,null,n)}function mf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=w(t),1===arguments.length&&(e=vi.u()),nf("doc","path",e),t instanceof ff)return sf(n=Ni.fromString.apply(Ni,a([e],r))),new pf(t,null,new Bi(n));if(!(t instanceof pf||t instanceof yf))throw new oi(ii.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return sf(n=t._path.child(Ni.fromString.apply(Ni,a([e],r)))),new pf(t.firestore,t instanceof yf?t._converter:null,new Bi(n))}function gf(t,e){return t=w(t),e=w(e),(t instanceof pf||t instanceof yf)&&(e instanceof pf||e instanceof yf)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function bf(t,e){return t=w(t),e=w(e),t instanceof df&&e instanceof df&&t.firestore===e.firestore&&Fo(t._query,e._query)&&t._converter===e._converter}var wf=function(){function t(){var t=this;this.fc=Promise.resolve(),this.dc=[],this.wc=!1,this._c=[],this.mc=null,this.yc=!1,this.gc=[],this.Zi=new eh(this,"async_queue_retry"),this.Ec=function(){var e=Zc();e&&ui("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Zc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ec)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.wc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Tc(),this.Ic(t)},t.prototype.enterRestrictedMode=function(){if(!this.wc){this.wc=!0;var t=Zc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ec)}},t.prototype.enqueue=function(t){return this.Tc(),this.wc?new Promise((function(t){})):this.Ic(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.dc.push(t),e.Ac()}))},t.prototype.Ac=function(){return r(this,void 0,void 0,(function(){var t,e=this;return i(this,(function(n){switch(n.label){case 0:if(0===this.dc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.dc[0]()];case 2:return n.sent(),this.dc.shift(),this.Zi.reset(),[3,4];case 3:if(!eu(t=n.sent()))throw t;return ui("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.dc.length>0&&this.Zi.ji((function(){return e.Ac()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Ic=function(t){var e=this,n=this.fc.then((function(){return e.yc=!0,t().catch((function(t){throw e.mc=t,e.yc=!1,ci("INTERNAL UNHANDLED ERROR: ",(r=(n=t).message||"",n.stack&&(r=n.stack.includes(n.message)?n.stack:n.message+"\n"+n.stack),r)),t;var n,r})).then((function(t){return e.yc=!1,t}))}));return this.fc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Tc(),this.gc.indexOf(t)>-1&&(e=0);var i=xh.createAndSchedule(this,t,e,n,(function(t){return r.Rc(t)}));return this._c.push(i),i},t.prototype.Tc=function(){this.mc&&fi()},t.prototype.verifyOperationInProgress=function(){},t.prototype.bc=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return[4,t=this.fc];case 1:e.sent(),e.label=2;case 2:if(t!==this.fc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.vc=function(t){for(var e=0,n=this._c;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Pc=function(t){var e=this;return this.bc().then((function(){e._c.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e._c;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.bc()}))},t.prototype.Vc=function(t){this.gc.push(t)},t.prototype.Rc=function(t){var e=this._c.indexOf(t);this._c.splice(e,1)},t}();function If(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Ef=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this)._queue=new wf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return e(n,t),n.prototype._terminate=function(){return this._firestoreClient||_f(this),this._firestoreClient.terminate()},n}(ff);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tf(t){return t._firestoreClient||_f(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function _f(t){var e,n,r,i,o,s=t._freezeSettings(),a=(n=t._databaseId,r=(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",i=t._persistenceKey,new Wl(n,r,i,(o=s).host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling));t._firestoreClient=new Fl(t._credentials,t._queue,a)}function Sf(t,e,n){var o=this,s=new Ya;return t.asyncQueue.enqueue((function(){return r(o,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,Ml(t,n)];case 1:return i.sent(),[4,Vl(t,e)];case 2:return i.sent(),s.resolve(),[3,4];case 3:if(!("FirebaseError"===(o=r=i.sent()).name?o.code===ii.FAILED_PRECONDITION||o.code===ii.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),s.reject(r),[3,4];case 4:return[2]}var o}))}))})).then((function(){return s.promise}))}function Nf(t){if(t._initialized||t._terminated)throw new oi(ii.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Df=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new oi(ii.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ai(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Af=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(ki.fromBase64String(e))}catch(n){throw new oi(ii.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}},t.fromUint8Array=function(e){return new t(ki.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Cf=function(t){this._methodName=t},kf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new oi(ii.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new oi(ii.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return mi(this._lat,t._lat)||mi(this._long,t._long)},t}(),Of=/^__.*__$/,Rf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new ds(t,this.data,this.fieldMask,e,this.fieldTransforms):new ps(t,this.data,e,this.fieldTransforms)},t}(),xf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new ds(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fi()}}var Pf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dc",{get:function(){return this.settings.Dc},enumerable:!1,configurable:!0}),t.prototype.Cc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Nc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Fc(t),r},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Sc(),r},t.prototype.Oc=function(t){return this.Cc({path:void 0,xc:!0})},t.prototype.$c=function(t){return ep(t,this.settings.methodName,this.settings.Mc||!1,this.path,this.settings.Lc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Sc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fc(this.path.get(t))},t.prototype.Fc=function(t){if(0===t.length)throw this.$c("Document fields must not be empty");if(Lf(this.Dc)&&Of.test(t))throw this.$c('Document fields cannot begin and end with "__"')},t}(),Ff=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||th(t)}return t.prototype.Bc=function(t,e,n,r){return void 0===r&&(r=!1),new Pf({Dc:t,methodName:e,Lc:n,path:Ai.emptyPath(),xc:!1,Mc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Mf(t){var e=t._freezeSettings(),n=th(t._databaseId);return new Ff(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Vf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Bc(o.merge||o.mergeFields?2:0,e,n,i);$f("Data must be an object, but it was:",s,r);var a,u,c=Yf(r,s);if(o.merge)a=new Ci(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var p=Jf(e,f[l],n);if(!s.contains(p))throw new oi(ii.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");np(h,p)||h.push(p)}a=new Ci(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new Rf(new eo(c),a,u)}var Uf=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype._toFieldTransform=function(t){if(2!==t.Dc)throw 1===t.Dc?t.$c(this._methodName+"() can only appear at the top level of your update data"):t.$c(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},n.prototype.isEqual=function(t){return t instanceof n},n}(Cf);function qf(t,e,n){return new Pf({Dc:3,Lc:e.settings.Lc,methodName:t._methodName,xc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Bf=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype._toFieldTransform=function(t){return new rs(t.path,new Yo)},n.prototype.isEqual=function(t){return t instanceof n},n}(Cf),jf=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return e(n,t),n.prototype._toFieldTransform=function(t){var e=qf(this,t,!0),n=this.qc.map((function(t){return Wf(t,e)})),r=new Xo(n);return new rs(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(Cf),Kf=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return e(n,t),n.prototype._toFieldTransform=function(t){var e=qf(this,t,!0),n=this.qc.map((function(t){return Wf(t,e)})),r=new Jo(n);return new rs(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(Cf),Gf=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return e(n,t),n.prototype._toFieldTransform=function(t){var e=new ts(t.R,Go(t.R,this.Uc));return new rs(t.path,e)},n.prototype.isEqual=function(t){return this===t},n}(Cf);function zf(t,e,n,r){var i=t.Bc(1,e,n);$f("Data must be an object, but it was:",i,r);var o=[],s=eo.empty();Ti(r,(function(t,r){var a=tp(e,t,n);r=w(r);var u=i.kc(a);if(r instanceof Uf)o.push(a);else{var c=Wf(r,u);null!=c&&(o.push(a),s.set(a,c))}}));var a=new Ci(o);return new xf(s,a,i.fieldTransforms)}function Hf(t,e,n,r,i,o){var s=t.Bc(1,e,n),a=[Jf(e,r,n)],u=[i];if(o.length%2!=0)throw new oi(ii.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Jf(e,o[c])),u.push(o[c+1]);for(var h=[],l=eo.empty(),f=a.length-1;f>=0;--f)if(!np(h,a[f])){var p=a[f],d=u[f];d=w(d);var y=s.kc(p);if(d instanceof Uf)h.push(p);else{var v=Wf(d,y);null!=v&&(h.push(p),l.set(p,v))}}var m=new Ci(h);return new xf(l,m,s.fieldTransforms)}function Qf(t,e,n,r){return void 0===r&&(r=!1),Wf(n,t.Bc(r?4:3,e))}function Wf(t,e){if(Xf(t=w(t)))return $f("Unsupported field value:",e,t),Yf(t,e);if(t instanceof Cf)return function(t,e){if(!Lf(e.Dc))throw e.$c(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.$c(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xc&&4!==e.Dc)throw e.$c("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Wf(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=w(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Go(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=wi.fromDate(t);return{timestampValue:$s(e.R,n)}}if(t instanceof wi)return n=new wi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:$s(e.R,n)};if(t instanceof kf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Af)return{bytesValue:Js(e.R,t._byteString)};if(t instanceof pf){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.$c("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ea(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.$c("Unsupported field value: "+uf(t))}(t,e)}function Yf(t,e){var n={};return _i(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ti(t,(function(t,r){var i=Wf(r,e.Nc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Xf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof wi||t instanceof kf||t instanceof Af||t instanceof pf||t instanceof Cf)}function $f(t,e,n){if(!Xf(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=uf(n);throw"an object"===r?e.$c(t+" a custom object"):e.$c(t+" "+r)}var i}function Jf(t,e,n){if((e=w(e))instanceof Df)return e._internalPath;if("string"==typeof e)return tp(t,e);throw ep("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Zf=new RegExp("[~\\*/\\[\\]]");function tp(t,e,n){if(e.search(Zf)>=0)throw ep("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Df.bind.apply(Df,a([void 0],e.split(".")))))._internalPath}catch(r){throw ep("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function ep(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new oi(ii.INVALID_ARGUMENT,(a+=". ")+t+u)}function np(t,e){return t.some((function(t){return t.isEqual(e)}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rp=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new pf(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new ip(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(op("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),ip=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.data=function(){return t.prototype.data.call(this)},n}(rp);function op(t,e){return"string"==typeof e?tp(t,e):e instanceof Df?e._internalPath:e._delegate._internalPath}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sp=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),ap=function(t){function n(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return e(n,t),n.prototype.exists=function(){return t.prototype.exists.call(this)},n.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new up(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},n.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(op("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},n}(rp),up=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},n}(ap),cp=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new sp(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new up(n._firestore,n._userDataWriter,r.key,r,new sp(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query._converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new oi(ii.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){var r=new up(t._firestore,t._userDataWriter,e.doc.key,e.doc,new sp(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new up(t._firestore,t._userDataWriter,e.doc.key,e.doc,new sp(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:hp(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function hp(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fi()}}function lp(t,e){return t instanceof ap&&e instanceof ap?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof cp&&e instanceof cp&&t._firestore===e._firestore&&bf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fp(t){if(Co(t)&&0===t.explicitOrderBy.length)throw new oi(ii.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var pp=function(){};function dp(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var yp=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.Kc=n,i.jc=r,i.type="where",i}return e(n,t),n.prototype._apply=function(t){var e,n,r,i=Mf(t.firestore),o=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new oi(ii.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Ep(s,o);for(var u=[],c=0,h=s;c<h.length;c++){var l=h[c];u.push(Ip(r,t,l))}a={arrayValue:{values:u}}}else a=Ip(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Ep(s,o),a=Qf(n,"where",s,"in"===o||"not-in"===o);var f=co.create(i,o,a);return function(t,e){if(e.g()){var n=Oo(t);if(null!==n&&!n.isEqual(e.field))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=ko(t);null!==r&&Tp(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new oi(ii.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new oi(ii.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t._query,0,i,t.firestore._databaseId,this.Qc,this.Kc,this.jc);return new df(t.firestore,t._converter,(e=t._query,n=o,r=e.filters.concat([n]),new So(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)))},n}(pp),vp=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Wc=n,r.type="orderBy",r}return e(n,t),n.prototype._apply=function(t){var e,n,r,i=function(t,e,n){if(null!==t.startAt)throw new oi(ii.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new oi(ii.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Io(e,n);return function(t,e){if(null===ko(t)){var n=Oo(t);null!==n&&Tp(t,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Wc);return new df(t.firestore,t._converter,(e=t._query,n=i,r=e.explicitOrderBy.concat([n]),new So(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))},n}(pp),mp=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Gc=n,i.zc=r,i}return e(n,t),n.prototype._apply=function(t){return new df(t.firestore,t._converter,Po(t._query,this.Gc,this.zc))},n}(pp),gp=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return e(n,t),n.prototype._apply=function(t){var e,n,r=wp(t,this.type,this.Hc,this.Jc);return new df(t.firestore,t._converter,(e=t._query,n=r,new So(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,n,e.endAt)))},n}(pp),bp=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return e(n,t),n.prototype._apply=function(t){var e,n,r=wp(t,this.type,this.Hc,this.Jc);return new df(t.firestore,t._converter,(e=t._query,n=r,new So(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,n)))},n}(pp);function wp(t,e,n,r){if(n[0]=w(n[0]),n[0]instanceof rp)return function(t,e,n,r,i){if(!r)throw new oi(ii.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=xo(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Yi(e,r.key));else{var c=r.data.field(u.field);if(Pi(c))throw new oi(ii.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new oi(ii.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new bo(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Mf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new oi(ii.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new oi(ii.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Ro(t)&&-1!==c.indexOf("/"))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Ni.fromString(c));if(!Bi.isDocumentKey(h))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Bi(h);a.push(Yi(e,l))}else{var f=Qf(n,r,c);a.push(f)}}return new bo(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Ip(t,e,n){if("string"==typeof(n=w(n))){if(""===n)throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ro(e)&&-1!==n.indexOf("/"))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Ni.fromString(n));if(!Bi.isDocumentKey(r))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Yi(t,new Bi(r))}if(n instanceof pf)return Yi(t,n._key);throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+uf(n)+".")}function Ep(t,e){if(!Array.isArray(t)||0===t.length)throw new oi(ii.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new oi(ii.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Tp(t,e,n){if(!n.isEqual(e))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _p=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),ji(t)){case 0:return null;case 1:return t.booleanValue;case 2:return xi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Li(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw fi()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Ti(t.fields||{},(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new kf(xi(t.latitude),xi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Fi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Mi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Ri(t);return new wi(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Ni.fromString(t);pi(Sa(n));var r=new Yl(n.get(1),n.get(3)),i=new Bi(n.popFirst(5));return r.isEqual(e)||ci("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sp(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Np=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return e(n,t),n.prototype.convertBytes=function(t){return new Af(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new pf(this.firestore,null,e)},n}(_p),Dp=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Mf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Ap(t,this._firestore),i=Sp(r._converter,e,n),o=Vf(this._dataReader,"WriteBatch.set",r._key,i,null!==r._converter,n);return this._mutations.push(o.toMutation(r._key,os.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Ap(t,this._firestore);return o="string"==typeof(e=w(e))||e instanceof Df?Hf(this._dataReader,"WriteBatch.update",s._key,e,n,r):zf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,os.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Ap(t,this._firestore);return this._mutations=this._mutations.concat(new ws(e._key,os.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new oi(ii.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ap(t,e){if((t=w(t)).firestore!==e)throw new oi(ii.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cp=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return e(n,t),n.prototype.convertBytes=function(t){return new Af(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new pf(this.firestore,null,e)},n}(_p);function kp(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=cf(t,pf);var o=cf(t.firestore,Ef),s=Mf(o);return Rp(o,[("string"==typeof(e=w(e))||e instanceof Df?Hf(s,"updateDoc",t._key,e,n,r):zf(s,"updateDoc",t._key,e)).toMutation(t._key,os.exists(!0))])}function Op(t){for(var e,n,o,s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];t=w(t);var u={includeMetadataChanges:!1},c=0;"object"!=typeof s[c]||If(s[c])||(u=s[c],c++);var h,l,f,p={includeMetadataChanges:u.includeMetadataChanges};if(If(s[c])){var d=s[c];s[c]=null===(e=d.next)||void 0===e?void 0:e.bind(d),s[c+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),s[c+2]=null===(o=d.complete)||void 0===o?void 0:o.bind(d)}if(t instanceof pf)l=cf(t.firestore,Ef),f=Do(t._key.path),h={next:function(e){s[c]&&s[c](xp(l,t,e))},error:s[c+1],complete:s[c+2]};else{var y=cf(t,df);l=cf(y.firestore,Ef),f=y._query;var v=new Cp(l);h={next:function(t){s[c]&&s[c](new cp(l,v,y,t))},error:s[c+1],complete:s[c+2]},fp(t._query)}return function(t,e,n,o){var s=this,a=new xl(o),u=new zh(e,a,n);return t.asyncQueue.enqueueAndForget((function(){return r(s,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=qh,[4,zl(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))})),function(){a.Wo(),t.asyncQueue.enqueueAndForget((function(){return r(s,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=Bh,[4,zl(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))}))}}(Tf(l),f,p,h)}function Rp(t,e){return function(t,e){var n=this,o=new Ya;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=el,[4,Gl(t)];case 1:return[2,n.apply(void 0,[r.sent(),e,o])]}}))}))})),o.promise}(Tf(t),e)}function xp(t,e,n){var r=n.docs.get(e._key),i=new Cp(t);return new ap(t,i,e._key,r,new sp(n.hasPendingWrites,n.fromCache),e._converter)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lp=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return e(n,t),n.prototype.get=function(e){var n=this,r=Ap(e,this._firestore),i=new Cp(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new ap(n._firestore,i,r._key,t._document,new sp(!1,!1),r._converter)}))},n}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Mf(t)}return t.prototype.get=function(t){var e=this,n=Ap(t,this._firestore),r=new Np(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return fi();var i=t[0];if(i.isFoundDocument())return new rp(e._firestore,r,i.key,i,n._converter);if(i.isNoDocument())return new rp(e._firestore,r,n._key,null,n._converter);throw fi()}))},t.prototype.set=function(t,e,n){var r=Ap(t,this._firestore),i=Sp(r._converter,e,n),o=Vf(this._dataReader,"Transaction.set",r._key,i,null!==r._converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Ap(t,this._firestore);return o="string"==typeof(e=w(e))||e instanceof Df?Hf(this._dataReader,"Transaction.update",s._key,e,n,r):zf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Ap(t,this._firestore);return this._transaction.delete(e._key),this},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pp(){if("undefined"==typeof Uint8Array)throw new oi(ii.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Fp(){if("undefined"==typeof atob)throw new oi(ii.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Mp=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Fp(),new t(Af.fromBase64String(e))},t.fromUint8Array=function(e){return Pp(),new t(Af.fromUint8Array(e))},t.prototype.toBase64=function(){return Fp(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return Pp(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Vp=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Nf(t=cf(t,Ef));var n=Tf(t),r=t._freezeSettings(),i=new Rl;return Sf(n,i,new kl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Nf(t=cf(t,Ef));var e=Tf(t),n=t._freezeSettings(),r=new Rl;return Sf(e,r,new Ol(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new oi(ii.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Ya;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return r(e,void 0,void 0,(function(){var e;return i(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return Ja.yt()?(e=t+"main",[4,Ja.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(cc(t._databaseId,t._persistenceKey))];case 1:return o.sent(),n.resolve(),[3,3];case 2:return e=o.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),Up=function(){function t(t,e,n){var r=this;this._delegate=e,this.Yc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Yl||(this.Xc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e){var n,r,i,o;n=this._delegate,r=t,i=e,"firestore.googleapis.com"!==(o=(n=cf(n,ff))._getSettings()).host&&o.host!==r&&hi("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},o),{host:r+":"+i,ssl:!1}))},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return r(e,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,Bl(t)];case 1:return e=r.sent(),[4,Kl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),i=n,o=di(i),o.$r.delete(0),uh(o))]}var i,o}))}))}))}(Tf(cf(this._delegate,Ef)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return r(e,void 0,void 0,(function(){var e,n;return i(this,(function(o){switch(o.label){case 0:return[4,Bl(t)];case 1:return e=o.sent(),[4,Kl(t)];case 2:return n=o.sent(),[2,(e.setNetworkEnabled(!1),function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return(e=di(t)).$r.add(0),[4,ch(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Tf(cf(this._delegate,Ef)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&of("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Yc.enableMultiTabIndexedDbPersistence(this):this.Yc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Yc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Xc&&(this.Xc._removeServiceInstance("firestore"),this.Xc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Ya;return t.asyncQueue.enqueueAndForget((function(){return r(e,void 0,void 0,(function(){var e;return i(this,(function(r){switch(r.label){case 0:return e=al,[4,Gl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Tf(cf(this._delegate,Ef)))},t.prototype.onSnapshotsInSync=function(t){return e=this._delegate,n=t,function(t,e){var n=this,o=new xl(e);return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=function(t,e){di(t).Gr.add(e),e.next()},[4,zl(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=function(t,e){di(t).Gr.delete(e)},[4,zl(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))}))}}(Tf(e=cf(e,Ef)),If(n)?n:{next:n});var e,n},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Xc)throw new oi(ii.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Xc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Zp(this,vf(this._delegate,t))}catch(e){throw zp(e,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Gp(this,mf(this._delegate,t))}catch(e){throw zp(e,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Xp(this,function(t,e){if(t=cf(t,ff),nf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new oi(ii.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new df(t,null,(n=e,new So(Ni.emptyPath(),n)));var n}(this._delegate,t))}catch(e){throw zp(e,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e,n=this;return function(t,e){var n=this,o=new Ya;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,(i=t,ql(i).then((function(t){return t.datastore})))];case 1:return n=r.sent(),new Pl(t.asyncQueue,n,e,o).run(),[2]}var i}))}))})),o.promise}(Tf(e=this._delegate),(function(r){return function(e){return t(new Bp(n,e))}(new Lp(e,r))}))},t.prototype.batch=function(){var t=this;return Tf(this._delegate),new jp(new Dp(this._delegate,(function(e){return Rp(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new oi(ii.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new oi(ii.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),qp=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return e(n,t),n.prototype.convertBytes=function(t){return new Mp(new Af(t))},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Gp.Zc(e,this.firestore,null)},n}(_p);var Bp=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new qp(t)}return t.prototype.get=function(t){var e=this,n=td(t);return this._delegate.get(n).then((function(t){return new Wp(e._firestore,new ap(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))}))},t.prototype.set=function(t,e,n){var r=td(t);return n?(rf("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=td(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,a([s,e,n],i)),this},t.prototype.delete=function(t){var e=td(t);return this._delegate.delete(e),this},t}(),jp=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=td(t);return n?(rf("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=td(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,a([s,e,n],i)),this},t.prototype.delete=function(t){var e=td(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Kp=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new up(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Yp(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.tu=function(e,n){var r=t.eu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new qp(e),n),i.set(n,o)),o},t}();Kp.eu=new WeakMap;var Gp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new qp(t)}return t.nu=function(e,n,r){if(e.length%2!=0)throw new oi(ii.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new pf(n._delegate,r,new Bi(e)))},t.Zc=function(e,n,r){return new t(n,new pf(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Zp(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Zp(this.firestore,vf(this._delegate,t))}catch(e){throw zp(e,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=w(t))instanceof pf&&gf(this._delegate,t)},t.prototype.set=function(t,e){e=rf("DocumentReference.set",e);try{return function(t,e,n){t=cf(t,pf);var r=cf(t.firestore,Ef),i=Sp(t._converter,e,n);return Rp(r,[Vf(Mf(r),"setDoc",t._key,i,null!==t._converter,n).toMutation(t._key,os.none())])}(this._delegate,t,e)}catch(n){throw zp(n,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?kp(this._delegate,t):kp.apply(void 0,a([this._delegate,t,e],n))}catch(i){throw zp(i,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Rp(cf((t=this._delegate).firestore,Ef),[new ws(t._key,os.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Hp(e),i=Qp(e,(function(e){return new Wp(t.firestore,new ap(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))}));return Op(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=cf(t,pf);var e=cf(t.firestore,Ef),n=Tf(e),o=new Cp(e);return function(t,e){var n=this,o=new Ya;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(s){switch(s.label){case 0:return n=function(t,e,n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(s=t,a=e,u=di(s),u.persistence.runTransaction("read document","readonly",(function(t){return u.Mn.mn(t,a)})))];case 1:return(o=i.sent()).isFoundDocument()?n.resolve(o):o.isNoDocument()?n.resolve(null):n.reject(new oi(ii.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=i.sent(),o=Lh(r,"Failed to get document '"+e+" from cache"),n.reject(o),[3,3];case 3:return[2]}var s,a,u}))}))},[4,jl(t)];case 1:return[2,n.apply(void 0,[s.sent(),e,o])]}}))}))})),o.promise}(n,t._key).then((function(n){return new ap(e,o,t._key,n,new sp(null!==n&&n.hasLocalMutations,!0),t._converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=cf(t,pf);var e=cf(t.firestore,Ef);return Hl(Tf(e),t._key,{source:"server"}).then((function(n){return xp(e,t,n)}))}(this._delegate):function(t){t=cf(t,pf);var e=cf(t.firestore,Ef);return Hl(Tf(e),t._key).then((function(n){return xp(e,t,n)}))}(this._delegate)).then((function(t){return new Wp(e.firestore,new ap(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(Kp.tu(this.firestore,e)):this._delegate.withConverter(null))},t}();function zp(t,e,n){return t.message=t.message.replace(e,n),t}function Hp(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!If(r))return r}return{}}function Qp(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=If(t[0])?t[0]:If(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Wp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Gp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return lp(this._delegate,t._delegate)},t}(),Yp=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.data=function(t){return this._delegate.data(t)},n}(Wp),Xp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new qp(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,dp(this._delegate,(o=r,s=i=n,a=op("where",e),new yp(a,s,o))))}catch(i){throw zp(i,/(orderBy|where)\(\)/,"Query.$1()")}var i,o,s,a},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,dp(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=op("orderBy",t);return new vp(r,n)}(e,n)))}catch(r){throw zp(r,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,dp(this._delegate,(hf("limit",n=e),new mp("limit",n,"F"))))}catch(r){throw zp(r,"limit()","Query.limit()")}var n},t.prototype.limitToLast=function(e){try{return new t(this.firestore,dp(this._delegate,(hf("limitToLast",n=e),new mp("limitToLast",n,"L"))))}catch(r){throw zp(r,"limitToLast()","Query.limitToLast()")}var n},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gp("startAt",t,!0)}.apply(void 0,e)))}catch(r){throw zp(r,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gp("startAfter",t,!1)}.apply(void 0,e)))}catch(r){throw zp(r,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new bp("endBefore",t,!0)}.apply(void 0,e)))}catch(r){throw zp(r,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new bp("endAt",t,!1)}.apply(void 0,e)))}catch(r){throw zp(r,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return bf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=cf(t,df);var e=cf(t.firestore,Ef),n=Tf(e),o=new Cp(e);return function(t,e){var n=this,o=new Ya;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(s){switch(s.label){case 0:return n=function(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a,u;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Ec(t,e,!0)];case 1:return u=i.sent(),r=new Wh(e,u.Bn),o=r._o(u.documents),s=r.applyChanges(o,!1),n.resolve(s.snapshot),[3,3];case 2:return a=i.sent(),u=Lh(a,"Failed to execute query '"+e+" against cache"),n.reject(u),[3,3];case 3:return[2]}}))}))},[4,jl(t)];case 1:return[2,n.apply(void 0,[s.sent(),e,o])]}}))}))})),o.promise}(n,t._query).then((function(n){return new cp(e,o,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=cf(t,df);var e=cf(t.firestore,Ef),n=Tf(e),r=new Cp(e);return Ql(n,t._query,{source:"server"}).then((function(n){return new cp(e,r,t,n)}))}(this._delegate):function(t){t=cf(t,df);var e=cf(t.firestore,Ef),n=Tf(e),r=new Cp(e);return fp(t._query),Ql(n,t._query).then((function(n){return new cp(e,r,t,n)}))}(this._delegate)).then((function(t){return new Jp(e.firestore,new cp(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Hp(e),i=Qp(e,(function(e){return new Jp(t.firestore,new cp(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return Op(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(Kp.tu(this.firestore,e)):this._delegate.withConverter(null))},t}(),$p=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Yp(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Jp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Xp(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new Yp(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new $p(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new Yp(n._firestore,r))}))},t.prototype.isEqual=function(t){return lp(this._delegate,t._delegate)},t}(),Zp=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return e(n,t),Object.defineProperty(n.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Gp(this.firestore,t):null},enumerable:!1,configurable:!0}),n.prototype.doc=function(t){try{return new Gp(this.firestore,void 0===t?mf(this._delegate):mf(this._delegate,t))}catch(e){throw zp(e,"doc()","CollectionReference.doc()")}},n.prototype.add=function(t){var e,n,r,i,o,s=this;return(e=this._delegate,n=t,r=cf(e.firestore,Ef),i=mf(e),o=Sp(e._converter,n),Rp(r,[Vf(Mf(e.firestore),"addDoc",i._key,o,null!==e._converter,{}).toMutation(i._key,os.exists(!1))]).then((function(){return i}))).then((function(t){return new Gp(s.firestore,t)}))},n.prototype.isEqual=function(t){return gf(this._delegate,t._delegate)},n.prototype.withConverter=function(t){return new n(this.firestore,t?this._delegate.withConverter(Kp.tu(this.firestore,t)):this._delegate.withConverter(null))},n}(Xp);function td(t){return cf(t,pf)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ed,nd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Df.bind.apply(Df,a([void 0],t)))}return t.documentId=function(){return new t(Ai.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=w(t))instanceof Df&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),rd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Bf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Uf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jf("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Kf("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=new Gf("increment",e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),id={Firestore:Up,GeoPoint:kf,Timestamp:wi,Blob:Mp,Transaction:Bp,WriteBatch:jp,DocumentReference:Gp,DocumentSnapshot:Wp,Query:Xp,QueryDocumentSnapshot:Yp,QuerySnapshot:Jp,CollectionReference:Zp,FieldPath:nd,FieldValue:rd,setLogLevel:function(t){var e;e=t,si.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(ed=Y).INTERNAL.registerComponent(new I("firestore",(function(t){return function(t,e){return new Up(t,new Ef(t,e),new Vp)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},id))),ed.registerVersion("@firebase/firestore","2.2.5");export{Y as f};
